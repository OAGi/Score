package org.oagi.srt.persistence.populate.script.oracle;

import org.oagi.srt.persistence.populate.script.DataImportScriptRunner;
import org.oagi.srt.repository.entity.*;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import javax.persistence.EntityManager;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Date;

import static org.oagi.srt.persistence.populate.script.oracle.OracleDataImportScriptPrinter.*;

@Component
@Lazy
public class OracleDataImportScriptRunner implements DataImportScriptRunner {

    @PostConstruct
    public void init() {
        turnOn();
    }

    @PreDestroy
    public void destroy() {
        turnOff();
    }

    @Override
    public void printHeader() {
        print("-- Generated by Semantic Refinement Tools Import Application");
        print("--   at:        " + new SimpleDateFormat("yyyy-MM-dd HH:mm:ss ZZZ").format(new Date()));
        print("");
        print("");
        print("");
    }

    @Override
    public void printSettings() {
        print("SET DEFINE OFF;");
        print("");
    }

    @Override
    public void printResetSequences(EntityManager entityManager) {
        print("");
        print("");
        printTitle("Reset Sequences");

        resetSequence(entityManager, Arrays.asList(
                AggregateCoreComponent.class,
                AgencyIdList.class,
                AgencyIdListValue.class,
                User.class,
                AssociationCoreComponentProperty.class,
                AssociationCoreComponent.class,
                BasicCoreComponentProperty.class,
                BasicCoreComponent.class,
                BusinessDataTypePrimitiveRestriction.class,
                BusinessDataTypeSupplementaryComponentPrimitiveRestriction.class,
                BlobContent.class,
                CoreDataTypeAllowedPrimitive.class,
                CoreDataTypeAllowedPrimitiveExpressionTypeMap.class,
                CoreDataTypePrimitive.class,
                CoreDataTypeSupplementaryComponentAllowedPrimitive.class,
                CoreDataTypeSupplementaryComponentAllowedPrimitiveExpressionTypeMap.class,
                CodeList.class,
                CodeListValue.class,
                DataType.class,
                DataTypeSupplementaryComponent.class,
                ModuleDep.class,
                Module.class,
                Namespace.class,
                Release.class,
                XSDBuiltInType.class));

        print("");
        print("");
        print("COMMIT;");
        print("");
        print("SET DEFINE ON;");
        print("");
    }
}
