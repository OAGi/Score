<mat-sidenav-container class="example-container" [hasBackdrop]="false">
  <mat-sidenav #sidenav>

  </mat-sidenav>

  <mat-sidenav-content (click)="sidenav.close();">
    <div class="cdk-overlay-backdrop cdk-overlay-dark-backdrop cdk-overlay-backdrop-showing" *ngIf="loading">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
    <div class="context-section">
      <div class="row m-0">
        <div class="col-12 p-0">
          <mat-card class="search-box-container mb-1">
            <mat-card-content>
              <div class="container-fluid" *ngIf="searcher && dataSource">
                <div class="row">
                  <div class="col-5 tree-search-box">
                    <div class="row align-items-center">
                      <div class="col-9">
                        <mat-form-field>
                          <mat-label *ngIf="!selectedNode">Search</mat-label>
                          <mat-label *ngIf="selectedNode">Search > {{selectedNode.name}}</mat-label>
                          <input matInput type="search" [(ngModel)]="searcher.inputKeyword"
                                 [disabled]="searcher.isSearching"
                                 (keyup.enter)="search(searcher.inputKeyword)">
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && searcher.searchResult.length > 0"
                                    align="end">{{searcher.searchIndex + 1}}/{{searcher.searchResult.length}} in {{ searcher.searchedItemCount }}{{ searcher.fullSearched ? '' : '+' }} nodes</mat-hint>
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && !searcher.fullSearched && searcher.searchResult.length === 0"
                                    align="end">0 results in {{ searcher.searchedItemCount }} nodes</mat-hint>
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && searcher.fullSearched && searcher.searchResult.length === 0"
                                    align="end">0 results</mat-hint>
                        </mat-form-field>
                      </div>
                      <div class="col-3 buttons">
                        <button mat-icon-button mat-small-icon-button
                                [disabled]="searcher.isSearching || !searcher.searchResult || searcher.searchResult.length === 0"
                                (click)="move(-1)">
                          <mat-icon>keyboard_arrow_up</mat-icon>
                        </button>
                        <button mat-icon-button mat-small-icon-button
                                [disabled]="searcher.isSearching || !searcher.searchResult || searcher.searchResult.length === 0"
                                (click)="move(1)">
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <button mat-icon-button mat-small-icon-button
                                [hidden]="searcher.fullSearched"
                                [disabled]="searcher.isSearching"
                                [matTooltip]="(searcher.searchKeyword && !searcher.fullSearched) ? 'Search more...' : 'Search'"
                                (click)="search(searcher.inputKeyword, false, true)">
                          <mat-icon>{{ (searcher.searchKeyword && !searcher.fullSearched) ? 'repeat' : 'search' }}</mat-icon>
                        </button>
                        <button mat-icon-button mat-small-icon-button
                                [disabled]="searcher.isSearching"
                                [hidden]="!searcher.inputKeyword"
                                (click)="searcher.inputKeyword = ''; searcher.resetSearch()">
                          <mat-icon>close</mat-icon>
                        </button>
                        <div style="height: 19px;">
                          <mat-progress-spinner mode="indeterminate" [diameter]="15" class="search-progress-bar"
                                                [hidden]="!searcher.isSearching"></mat-progress-spinner>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-7 actions-wrap">
                    <div class="actions ml-auto d-flex align-items-center">
                      <div>
                        <button mat-icon-button mat-small-icon-button [id]="'bie-settings'"
                                [matMenuTriggerFor]="settingsContextMenu"
                                [matMenuTriggerData]="{'menuId': 'settingsContextMenu'}">
                          <mat-icon>settings</mat-icon>
                        </button>
                      </div>
                      <div class="ml-3">
                        <button mat-raised-button color="primary" (click)="updateDetails()"
                                matBadgePosition="below after" matBadge="{{ sizeOfChanges }}"
                                [matBadgeHidden]="sizeOfChanges === 0"
                                *ngIf="state === 'WIP' && (access === 'CanEdit' || isAdmin)"
                                [disabled]="updateDisabled">
                          Update
                        </button>
                        <button mat-raised-button color="accent" (click)="updateState('QA')"
                                *ngIf="state === 'WIP' && (access === 'CanEdit' || isAdmin)"
                                [disabled]="isUpdating || isChanged || !isValid">
                          Move to QA
                        </button>
                        <button mat-raised-button color="warn" (click)="updateState('WIP')"
                                *ngIf="state === 'QA' && (access === 'CanMove' || isAdmin)"
                                [disabled]="isUpdating">
                          Back to WIP
                        </button>
                        <button mat-raised-button color="accent" (click)="updateState('Production')"
                                *ngIf="state === 'QA' && (access === 'CanMove' || isAdmin)"
                                [disabled]="isUpdating">
                          Move to Production
                        </button>
                      </div>
                    </div>
                    <mat-menu class="context-menu" #settingsContextMenu="matMenu">
                      <button mat-menu-item [id]="'bie-settings-hide-cardinality'">
                        <mat-checkbox class="d-inline-flex pr-2" [(ngModel)]="hideCardinality">
                          <span>Hide cardinality</span>
                        </mat-checkbox>
                      </button>
                      <button mat-menu-item [id]="'bie-settings-hide-unused'">
                        <mat-checkbox class="d-inline-flex pr-2" [(ngModel)]="hideUnused">
                          <span>Hide unused</span>
                        </mat-checkbox>
                      </button>
                    </mat-menu>
                  </div>
                </div>
                <div class="row">
                  <div class="tree-breadcrumbs-wrap" id="tree-breadcrumbs-wrap" *ngIf="selectedNode">
                    <div class="tree-breadcrumb"
                         *ngFor="let bread of selectedNode.parents; let last = last;">
                      <span aria-hidden="true" class="tree-breadcrumb-separator">/</span>
                      <span *ngIf="last"
                            class="tree-breadcrumb-item-last">{{ bread.name }} {{ last ? scrollBreadcrumb('tree-breadcrumbs-wrap') : '' }}</span>
                      <span *ngIf="!last" class="tree-breadcrumb-item"
                            (click)="scrollToNode(bread)">{{ bread.name }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div class="row m-0" (window:resize)="onResize($event)">
        <div class="col-12 p-0">
          <as-split unit="percent" [direction]="'horizontal'" style="overflow-y: scroll;">
            <as-split-area class="left-panel" size="30">
              <mat-card class="bie-node-tree-panel">
                <mat-card-content class="mat-card-container">
                  <cdk-virtual-scroll-viewport itemSize="{{ virtualScrollItemSize }}"
                                               minBufferPx="{{ minBufferPx }}" maxBufferPx="{{ maxBufferPx }}"
                                               [style.height.px]="innerHeight" #virtualScroll>
                    <div *cdkVirtualFor="let node of dataSource" class="example-item"
                         (mouseover)="node.showCopyLinkIcon = true" (mouseout)="node.showCopyLinkIcon = false">
                      <div class="mat-tree-node d-flex pointer"
                           tabIndex="0"
                           [attr.data-level]="node.level"
                           [attr.data-path]="node.path"
                           [class]="{'tree-node-selected': cursorNode === node}"
                           (click)="onClick(node, $event)"
                           (keydown)="keyNavigation(node, $event)"
                           [style.padding-left]="node.level * paddingPixel + 'px'">
                        <button *ngIf="dataSource.isExpandable(node); else disabledRef;"
                                (click)="toggle(node, $event)"
                                class="align-self-center"
                                mat-icon-button>
                          <mat-icon class="mat-icon-rtl-mirror">
                            {{ node.expanded ? 'expand_more' : 'chevron_right' }}
                          </mat-icon>
                        </button>
                        <ng-template #disabledRef>
                          <button mat-icon-button disabled></button>
                        </ng-template>

                        <mat-checkbox class="bie-checkbox"
                                      *ngIf="node.level > 0"
                                      [checked]="used(node)"
                                      [disabled]="!isUsable(node)"
                                      [color]="(node.used === undefined) ? 'warn' : undefined"
                                      (click)="toggleTreeUsed(node, $event)"
                                      [matTooltip]="getNodeTooltip(node)"
                                      [matTooltipDisabled]="getNodeTooltip(node) === ''">
                        </mat-checkbox>

                        <span [class]="['align-self-center', node.type.toLowerCase(),
                                        this.searcher.searchResult.indexOf(node) > -1 ? 'inside' : 'outside']"
                              [class.deprecated]="node.deprecated"
                              [matTooltip]="node.deprecated ? 'Deprecated' : ''"
                              [class.search-index]="this.searcher.searchResult.indexOf(node) === this.searcher.searchIndex"
                              [innerHTML]="node.name | highlight : searcher.searchKeyword">
                        </span>

                        <span [class]="['pl-3']" *ngIf="!dataSource.hideCardinality">
                          {{ node.cardinalityMin + '..' + ((node.cardinalityMax === -1) ? '&infin;' : node.cardinalityMax) }}
                        </span>

                        <fa-icon [icon]="faRecycle"
                                 matTooltip="Reused"
                                 [class]="['pl-3', 'pointer']" *ngIf="node.derived"
                                 (click)="openNewEditBieTab(node)"></fa-icon>
                        <div class="ml-auto align-self-center mr-2" style="margin-bottom: 3px">
                          <mat-icon [hidden]="!node.showCopyLinkIcon"
                                    class="copy-link-icon"
                                    matTooltip="Copy Link"
                                    (click)="copyLink(node, $event)">
                            link
                          </mat-icon>
                          <mat-icon class="context-menu-icon"
                                    [matMenuTriggerFor]="contextMenu"
                                    [matMenuTriggerData]="{'menuId': 'contextMenu'}"
                                    (click)="contextMenuItem = node; $event.stopPropagation();">more_vert
                          </mat-icon>
                        </div>
                      </div>
                    </div>
                  </cdk-virtual-scroll-viewport>

                  <!-- Context Menu Area -->
                  <mat-menu class="context-menu" #contextMenu="matMenu">
                    <button mat-menu-item (click)="copyPath(contextMenuItem)">
                      <span class="context-menu-item">Copy Path</span>
                    </button>
                    <mat-divider *ngIf="dataSource && dataSource.isExpandable(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="dataSource.expandDescendants(contextMenuItem, 2)"
                            *ngIf="dataSource && dataSource.isExpandable(contextMenuItem)">
                      <span class="context-menu-item">Expand 2</span>
                    </button>
                    <button mat-menu-item (click)="dataSource.expandDescendants(contextMenuItem, 3)"
                            *ngIf="dataSource && dataSource.isExpandable(contextMenuItem)">
                      <span class="context-menu-item">Expand 3</span>
                    </button>
                    <mat-divider *ngIf="canReuseBIE(contextMenuItem) || canCreateBIEFromThis(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="reuseBIE(contextMenuItem)"
                            *ngIf="canEdit && canReuseBIE(contextMenuItem)">
                      <span class="context-menu-item">Reuse BIE</span>
                    </button>
                    <button mat-menu-item (click)="createBIEfromThis(contextMenuItem)"
                            *ngIf="canCreateBIEFromThis(contextMenuItem)"
                            [disabled]="isTenantEnabled">
                      <span class="context-menu-item">Make BIE reusable</span>
                    </button>
                    <mat-divider *ngIf="canRemoveReusedBIE(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="findReuses(contextMenuItem)"
                            *ngIf="canEdit && canRemoveReusedBIE(contextMenuItem)">
                      <span class="context-menu-item">Find Reuses</span>
                    </button>
                    <button mat-menu-item (click)="removeReusedBIE(contextMenuItem)"
                            *ngIf="canEdit && canRemoveReusedBIE(contextMenuItem)">
                      <span class="context-menu-item">Remove Reused BIE</span>
                    </button>
                    <button mat-menu-item (click)="retainReusedBIE(contextMenuItem)"
                            *ngIf="canEdit && canRemoveReusedBIE(contextMenuItem)">
                      <span class="context-menu-item">Retain Reused BIE</span>
                    </button>
                    <mat-divider *ngIf="canEdit && isExtension(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="createLocalAbieExtension(contextMenuItem)"
                            *ngIf="canEdit && isExtension(contextMenuItem)"
                            [disabled]="!canExtend(contextMenuItem) || isTenantEnabled"
                            [matTooltip]="'Developer cannot create ABIE Extension'"
                            [matTooltipDisabled]="canExtend(contextMenuItem)">
                      <span class="context-menu-item">Create ABIE Extension Locally</span>
                    </button>
                    <button mat-menu-item (click)="createGlobalAbieExtension(contextMenuItem)"
                            *ngIf="canEdit && isExtension(contextMenuItem)"
                            [disabled]="!canExtend(contextMenuItem) || isTenantEnabled"
                            [matTooltip]="'Developer cannot create ABIE Extension'"
                            [matTooltipDisabled]="canExtend(contextMenuItem)">
                      <span class="context-menu-item">Create ABIE Extension Globally</span>
                    </button>
                    <mat-divider *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="enableChildren(contextMenuItem)"
                            *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)"
                            [disabled]="!isUsableChildren(contextMenuItem)">
                      <span class="context-menu-item">Enable Children</span>
                    </button>
                    <button mat-menu-item (click)="setMaxCardinality(contextMenuItem)"
                            *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)"
                            [disabled]="!isCardinalityEditable(contextMenuItem)">
                      <span class="context-menu-item">Set Children Max Cardinality to 1</span>
                    </button>
                    <mat-divider *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)"></mat-divider>
                    <button mat-menu-item (click)="checkNillableOnChildBCCs(contextMenuItem)"
                            *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)">
                      <span class="context-menu-item">Check nillable on Child BCCs</span>
                    </button>
                    <button mat-menu-item (click)="uncheckNillableOnChildBCCs(contextMenuItem)"
                            *ngIf="canEdit && dataSource && dataSource.isExpandable(contextMenuItem)">
                      <span class="context-menu-item">Uncheck nillable on Child BCCs</span>
                    </button>
                  </mat-menu>
                </mat-card-content>
              </mat-card>
            </as-split-area>
            <as-split-area class="right-panel" size="70" [style.height.px]="innerHeight + 17">
              <!-- ABIE -->
              <div class="bie-edit-detail-panel scroll" *ngIf="isAbieDetail() && asAbieDetail().isLoaded">
                <mat-tab-group mat-align-tabs="start">
                  <mat-tab label="{{ selectedNode.name }}">
                    <div class="bie-edit-detail-container">
                      <div class="row">
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Release</mat-label>
                            <input matInput placeholder="Release" [(ngModel)]="rootNode.releaseNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>State</mat-label>
                            <input matInput placeholder="State" [(ngModel)]="rootNode.topLevelAsbiepState" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-3">
                          <mat-form-field>
                            <mat-label>Owner</mat-label>
                            <input matInput placeholder="Owner" [(ngModel)]="rootNode.loginId" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-1">
                          <button mat-icon-button (click)="resetDetail(selectedNode)"
                                  *ngIf="state === 'WIP'"
                                  matTooltip="Reset detail"
                                  [disabled]="isUpdating || access !== 'CanEdit'">
                            <mat-icon>refresh</mat-icon>
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Business Contexts</mat-label>
                            <mat-chip-grid #businessContextChipList>
                              @for (businessContext of businessContexts; track businessContext) {
                                <mat-chip-row
                                    [removable]="isBusinessContextRemovable"
                                    (removed)="removeBusinessContext(businessContext)">
                                  {{ businessContext.name }}
                                  <button matChipRemove [attr.aria-label]="isBusinessContextRemovable">
                                    <mat-icon>cancel</mat-icon>
                                  </button>
                                </mat-chip-row>
                              }
                              <input
                                placeholder="Business Context"
                                #businessContextInput
                                [formControl]="businessContextCtrl"
                                [matAutocomplete]="auto"
                                [matChipInputFor]="businessContextChipList"
                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                [matChipInputAddOnBlur]="addOnBlur">
                            </mat-chip-grid>
                            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addBusinessContext($event)">
                              @for (businessContext of filteredBusinessContexts | async; track businessContext) {
                                <mat-option [value]="businessContext">{{ businessContext.name }}</mat-option>
                              }
                            </mat-autocomplete>
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-md-3 col-sm-6">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="rootNode.deprecated"
                                          [disabled]="true">
                              Deprecated
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-md-3 col-sm-6" *ngIf="isBIEInverseModeEnabled">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="rootNode.inverseMode"
                                          (change)="updateInverseMode()">
                              Inverse Mode
                            </mat-checkbox>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Legacy Business Term</mat-label>
                            <input matInput placeholder="Legacy Business Term" maxlength="225"
                                   [(ngModel)]="asAbieDetail().asbiep.bizTerm"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Remark</mat-label>
                            <input matInput placeholder="Remark" maxlength="225"
                                   [(ngModel)]="asAbieDetail().asbiep.remark"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Version</mat-label>
                            <input matInput placeholder="Version" maxlength="45"
                                   [(ngModel)]="rootNode.version"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Status</mat-label>
                            <input matInput placeholder="Status" maxlength="45"
                                   [(ngModel)]="rootNode.status"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Context Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Context Definition"
                                        [(ngModel)]="asAbieDetail().asbiep.definition"
                                        [readonly]="!isEditable(selectedNode)">
                              </textarea>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Component Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Component Definition" [readonly]="true"
                                        value="{{ asAbieDetail().asccp.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asAbieDetail().asccp.definition, asAbieDetail().asbiep)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Type Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Type Definition" [readonly]="true"
                                        value="{{ asAbieDetail().acc.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asAbieDetail().acc.definition, asAbieDetail().asbiep)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>

              <!-- ASBIEP -->
              <div class="bie-edit-detail-panel scroll" *ngIf="isAsbiepDetail()">
                <mat-tab-group mat-align-tabs="start">
                  <mat-tab label="{{ selectedNode.name }}">
                    <div class="bie-edit-detail-container">
                      <div class="row align-items-center">
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [disabled]="!isUsable(selectedNode)"
                                          [checked]="used(selectedNode)"
                                          (click)="toggleDetailUsed(selectedNode, $event)"
                                          matTooltip="This component is required."
                                          [matTooltipDisabled]="!selectedNode.required">
                              Used
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="asAsbiepDetail().asbie.deprecated"
                                          [matTooltip]="selectedNode.ccDeprecated ? 'Core Component is deprecated.' : ''"
                                          [disabled]="!isEditable(selectedNode) || selectedNode.ccDeprecated">
                              Deprecated
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="asAsbiepDetail().asbie.nillable"
                                          matTooltip="This property cannot change since the Core Component is not nillable."
                                          [matTooltipDisabled]="asAsbiepDetail().asccp.nillable"
                                          [disabled]="!isEditable(selectedNode) ||
                                                      !asAsbiepDetail().asccp.nillable">
                              Nillable
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-2"></div>
                        <div class="col-1">
                          <button mat-icon-button (click)="resetDetail(selectedNode)"
                                  *ngIf="state === 'WIP'"
                                  matTooltip="Reset detail"
                                  [disabled]="isUpdating || access !== 'CanEdit' || !selectedNode.used">
                            <mat-icon>refresh</mat-icon>
                          </button>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Min</mat-label>
                            <input matInput placeholder="Cardinality Min" required
                                   [formControl]="bieCardinalityMin">
                            <mat-error *ngIf="bieCardinalityMin.hasError('required') || bieCardinalityMin.hasError('whitespace')">
                              Cardinality Min is <strong>required</strong>
                            </mat-error>
                            <mat-error
                              *ngIf="!bieCardinalityMin.hasError('min') && bieCardinalityMin.hasError('pattern')">
                              '{{ bieCardinalityMin.value }}' is not allowed for Cardinality Min
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('min')">
                              Cardinality Min must be greater than or equals
                              to {{ asAsbiepDetail().ascc && asAsbiepDetail().ascc.cardinalityMin }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('max')">
                              {{ bieCardinalityMin.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Max</mat-label>
                            <input matInput placeholder="Cardinality Max (-1 for unbounded, Standard is {{ asAsbiepDetail().ascc.cardinalityMax | unbounded}})" required
                                   [formControl]="bieCardinalityMax"
                                   [value]="bieCardinalityMax.value | unbounded">
                            <mat-hint *ngIf="bieCardinalityMax.valid && asAsbiepDetail().asbie && asAsbiepDetail().asbie.cardinalityMax === 0 &&
                                            (!asAsbiepDetail().asbie.definition || asAsbiepDetail().asbie.definition === '')"
                                      style="color: #ff5722;">
                              Context Definition should define why Cardinality Max is zero (0)
                            </mat-hint>

                            <mat-error *ngIf="bieCardinalityMax.hasError('required') || bieCardinalityMax.hasError('whitespace')">
                              Cardinality Max is <strong>required</strong>
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('pattern')">
                              '{{ bieCardinalityMax.value }}' is not allowed for Cardinality Max
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('min')">
                              {{ bieCardinalityMax.getError('min') }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('max')">
                              {{ bieCardinalityMax.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row" *ngIf="selectedNode && !selectedNode.derived && !reusedNode">
                        <div class="col-md-6 col-sm-12">
                          <div class="actions" *ngIf="isBusinessTermEnabled && !isDeveloper">
                            <button class="hover-button" mat-raised-button color="primary"
                                    (click)="goToBusinessTermsForBie(selectedNode.detail, 'ASBIE')">
                              Show Business Terms
                            </button>
                            <button mat-raised-button
                                    [disabled]="!isEditable(selectedNode)"
                                    (click)="goToAssignBusinessTermsForBie(selectedNode.detail, 'ASBIE')">
                              Assign Business Term
                            </button>
                          </div>
                          <mat-form-field *ngIf="!isBusinessTermEnabled || isDeveloper">
                            <mat-label>Legacy Business Term</mat-label>
                            <input matInput placeholder="Legacy Business Term" maxlength="225"
                                   [(ngModel)]="asAsbiepDetail().asbiep.bizTerm"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Remark</mat-label>
                            <input matInput placeholder="Remark" maxlength="225"
                                   [(ngModel)]="asAsbiepDetail().asbiep.remark"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Context Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Context Definition"
                                        [(ngModel)]="asAsbiepDetail().asbie.definition"
                                        [readonly]="!isEditable(selectedNode)">
                              </textarea>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div *ngIf="selectedNode && selectedNode.derived && reusedNode && reusedNodeDetail" class="detail-reused">
                        <h4 class="mb-2"> From Reused BIE</h4>
                        <div class="row">
                          <div class="col-4">
                            <mat-form-field>
                              <mat-label>Release</mat-label>
                              <input matInput [(ngModel)]="reusedNode.releaseNum" [disabled]="true">
                            </mat-form-field>
                          </div>
                          <div class="col-4">
                            <mat-form-field>
                              <mat-label>State</mat-label>
                              <input matInput [(ngModel)]="reusedNode.topLevelAsbiepState" [disabled]="true">
                            </mat-form-field>
                          </div>
                          <div class="col-4">
                            <mat-form-field>
                              <mat-label>Owner</mat-label>
                              <input matInput [(ngModel)]="reusedNode.loginId" [disabled]="true">
                            </mat-form-field>
                          </div>
                        </div>
                        <mat-form-field *ngIf="reusedBusinessContexts.length > 0">
                          <mat-label>Business Contexts</mat-label>
                          <mat-chip-grid #reusedBusinessContextChipList>
                            @for (businessContext of reusedBusinessContexts; track businessContext) {
                              <mat-chip-row
                                [selectable]="false"
                                [removable]="false">
                                {{ businessContext.name }}
                              </mat-chip-row>
                            }
                            <input
                              placeholder="Business Context"
                              [matChipInputFor]="reusedBusinessContextChipList">
                          </mat-chip-grid>
                        </mat-form-field>

                        <div class="row">
                          <div class="col-md-3 col-sm-6">
                            <div class="checkbox">
                              <mat-checkbox color="primary"
                                            [(ngModel)]="reusedNode.deprecated"
                                            [disabled]="true">
                                Deprecated
                              </mat-checkbox>
                            </div>
                          </div>
                          <div class="col-md-3 col-sm-6" *ngIf="isBIEInverseModeEnabled">
                            <div class="checkbox">
                              <mat-checkbox color="primary"
                                            [(ngModel)]="reusedNode.inverseMode"
                                            [disabled]="true">
                                Inverse Mode
                              </mat-checkbox>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-6 col-sm-12">
                            <mat-form-field>
                              <mat-label>Legacy Business Term</mat-label>
                              <input matInput placeholder="Legacy Business Term" maxlength="225"
                                     [value]="reusedNodeDetail.asbiep.bizTerm"
                                     [disabled]="true">
                            </mat-form-field>
                          </div>
                          <div class="col-md-6 col-sm-12">
                            <mat-form-field>
                              <mat-label>Remark</mat-label>
                              <input matInput placeholder="Remark" maxlength="225"
                                     [value]="reusedNodeDetail.asbiep.remark"
                                     [disabled]="true">
                            </mat-form-field>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-6 col-sm-12">
                            <mat-form-field>
                              <mat-label>Version</mat-label>
                              <input matInput placeholder="Version" maxlength="225"
                                     [value]="reusedNode.version"
                                     [disabled]="true">
                            </mat-form-field>
                          </div>
                          <div class="col-md-6 col-sm-12">
                            <mat-form-field>
                              <mat-label>Status</mat-label>
                              <input matInput placeholder="Status" maxlength="225"
                                     [value]="reusedNode.status"
                                     [disabled]="true">
                            </mat-form-field>
                          </div>
                        </div>

                        <mat-form-field>
                          <mat-label>Context Definition</mat-label>
                          <div class="textarea-container">
                            <textarea matInput rows="6"
                                      placeholder="Context Definition"
                                      [value]="reusedNodeDetail.asbiep.definition"
                                      [readonly]="true"></textarea>
                            <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                    (click)="copyToDefinition(reusedNodeDetail.asbiep.definition, asAsbiepDetail().asbie)"
                                    matTooltip="Copy to Context Definition">
                              <mat-icon>content_paste</mat-icon>
                            </button>
                          </div>
                        </mat-form-field>
                      </div>

                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Association Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Association Definition" [readonly]="true"
                                        value="{{ asAsbiepDetail().ascc.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asAsbiepDetail().ascc.definition, asAsbiepDetail().asbie)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Component Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Component Definition" [readonly]="true"
                                        value="{{ asAsbiepDetail().asccp.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asAsbiepDetail().asccp.definition, asAsbiepDetail().asbie)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Type Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Type Definition" [readonly]="true"
                                        value="{{ asAsbiepDetail().acc.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asAsbiepDetail().acc.definition, asAsbiepDetail().asbie)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>

              <!-- BBIEP -->
              <div class="bie-edit-detail-panel scroll" *ngIf="isBbiepDetail()">
                <mat-tab-group mat-align-tabs="start">
                  <mat-tab label="{{ selectedNode.name }}">
                    <div class="bie-edit-detail-container">
                      <div class="row align-items-center">
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [checked]="used(selectedNode)"
                                          (click)="toggleDetailUsed(selectedNode, $event)"
                                          [disabled]="!isUsable(selectedNode)"
                                          matTooltip="This component is required."
                                          [matTooltipDisabled]="!selectedNode.required">
                              Used
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="asBbiepDetail().bbie.deprecated"
                                          [matTooltip]="selectedNode.ccDeprecated ? 'Core Component is deprecated.' : ''"
                                          [disabled]="!isEditable(selectedNode) || selectedNode.ccDeprecated">
                              Deprecated
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="asBbiepDetail().bbie.nillable"
                                          matTooltip="This property cannot change since the Core Component is not nillable."
                                          [matTooltipDisabled]="asBbiepDetail().bccp.nillable"
                                          [disabled]="!isEditable(selectedNode)||
                                                      !asBbiepDetail().bccp.nillable">
                              Nillable
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-2"></div>
                        <div class="col-1">
                          <button mat-icon-button (click)="resetDetail(selectedNode)"
                                  *ngIf="state === 'WIP'"
                                  matTooltip="Reset detail"
                                  [disabled]="isUpdating || access !== 'CanEdit' || !selectedNode.used">
                            <mat-icon>refresh</mat-icon>
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Min</mat-label>
                            <input matInput placeholder="Cardinality Min" required
                                   [formControl]="bieCardinalityMin">
                            <mat-error *ngIf="bieCardinalityMin.hasError('required') || bieCardinalityMin.hasError('whitespace')">
                              Cardinality Min is <strong>required</strong>
                            </mat-error>
                            <mat-error
                              *ngIf="!bieCardinalityMin.hasError('min') && bieCardinalityMin.hasError('pattern')">
                              '{{ bieCardinalityMin.value }}' is not allowed for Cardinality Min
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('min')">
                              Cardinality Min must be greater than or equals to {{ asBbiepDetail().bcc.cardinalityMin }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('max')">
                              {{ bieCardinalityMin.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Max</mat-label>
                            <input matInput placeholder="Cardinality Max (-1 for unbounded, Standard is {{ asBbiepDetail().bcc.cardinalityMax | unbounded}})" required
                                   [formControl]="bieCardinalityMax"
                                   [value]="bieCardinalityMax.value | unbounded">
                            <mat-hint *ngIf="bieCardinalityMax.valid && asBbiepDetail().bbie.cardinalityMax === 0 &&
                                            (!asBbiepDetail().bbie.definition || asBbiepDetail().bbie.definition === '')"
                                      style="color: #ff5722;">
                              Context Definition should define why Cardinality Max is zero (0)
                            </mat-hint>

                            <mat-error *ngIf="bieCardinalityMax.hasError('required') || bieCardinalityMax.hasError('whitespace')">
                              Cardinality Max is <strong>required</strong>
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('pattern')">
                              '{{ bieCardinalityMax.value }}' is not allowed for Cardinality Max
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('min')">
                              {{ bieCardinalityMax.getError('min') }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('max')">
                              {{ bieCardinalityMax.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6 col-sm-12">
                          <div class="actions" *ngIf="isBusinessTermEnabled && !isDeveloper">
                            <button class="hover-button" mat-raised-button color="primary"
                                    (click)="goToBusinessTermsForBie(selectedNode.detail, 'BBIE')">
                              Show Business Terms
                            </button>
                            <button mat-raised-button
                                    [disabled]="!isEditable(selectedNode)"
                                    (click)="goToAssignBusinessTermsForBie(selectedNode.detail, 'BBIE')">
                              Assign Business Term
                            </button>
                          </div>
                          <mat-form-field *ngIf="!isBusinessTermEnabled || isDeveloper">
                            <mat-label>Legacy Business Term</mat-label>
                            <input matInput placeholder="Legacy Business Term" maxlength="225"
                                   [(ngModel)]="asBbiepDetail().bbiep.bizTerm"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Remark</mat-label>
                            <input matInput placeholder="Remark" maxlength="225"
                                   [(ngModel)]="asBbiepDetail().bbiep.remark"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Example</mat-label>
                            <input matInput placeholder="Example"
                                   [(ngModel)]="asBbiepDetail().bbie.example"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row form-field-box">
                        <div class="col-md-6 col-sm-12">
                          <mat-card>
                            <mat-card-content
                              matTooltip="This value constraint cannot modify by the definition of the Business Information Entity."
                              [matTooltipDisabled]="!isReflectValue()">
                              <mat-form-field>
                                <mat-label>Value Constraint</mat-label>
                                <mat-select [(ngModel)]="asBbiepDetail().bbie.fixedOrDefault"
                                            [disabled]="!isEditable(selectedNode) ||
                                                        isReflectValue()"
                                            (ngModelChange)="onChangeFixedOrDefault(asBbiepDetail().bbie.fixedOrDefault)">
                                  <mat-option value="none">None</mat-option>
                                  <mat-option value="fixed">Fixed Value</mat-option>
                                  <mat-option value="default">Default Value</mat-option>
                                </mat-select>
                              </mat-form-field>
                              <mat-form-field *ngIf="asBbiepDetail().bbie.fixedOrDefault == 'none'">
                                <mat-label>No value constraints</mat-label>
                                <input matInput placeholder="No value constraints"
                                       [disabled]="true">
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbiepDetail().bbie.fixedOrDefault == 'fixed'">
                                <mat-label>Fixed Value</mat-label>
                                <input matInput placeholder="Fixed Value"
                                       [(ngModel)]="asBbiepDetail().bbie.fixedValue"
                                       [disabled]="!isEditable(selectedNode) ||
                                                   isReflectValue()">
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbiepDetail().bbie.fixedOrDefault == 'default'">
                                <mat-label>Default Value</mat-label>
                                <input matInput placeholder="Default Value"
                                       [(ngModel)]="asBbiepDetail().bbie.defaultValue"
                                       [disabled]="!isEditable(selectedNode) ||
                                                   !!(isVersionIdNode(selectedNode) && rootNode.version) ||
                                                   isReflectValue()">
                              </mat-form-field>
                            </mat-card-content>
                          </mat-card>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-card>
                            <mat-card-content>
                              <mat-form-field>
                                <mat-label>Value Domain Restriction</mat-label>
                                <mat-select placeholder="Value Domain Restriction" required
                                            [(ngModel)]="asBbiepDetail().bbie.valueDomainType"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option *ngFor="let valueDomainType of valueDomainTypes"
                                              [value]="valueDomainType.valueOf()">
                                    {{ valueDomainType.toString() | separate }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                              <mat-form-field *ngIf="asBbiepDetail().bbie.valueDomainType === 'Primitive'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbiepDetail().bbie.bdtPriRestriId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Primitive Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let xbt of filteredValueDomains | async"
                                              [value]="xbt.id">
                                    {{ xbt.name }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbiepDetail().bbie.valueDomainType === 'Code'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbiepDetail().bbie.codeListManifestId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Code Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let codeList of filteredValueDomains | async"
                                              [value]="codeList.id">
                                    <div [class]="['d-flex']"
                                         [class.text-warning]="codeList.state !== 'Deleted' && !isValidState(codeList.state)"
                                         [class.text-danger]="codeList.state === 'Deleted'"
                                         [class.text-line-through]="codeList.state === 'Deleted'"
                                         [class.deprecated]="codeList.deprecated"
                                         [matTooltip]="codeList.state === 'Deleted' ? 'This code list is deleted' : 'This code list is usable but unstable'"
                                         [matTooltipDisabled]="isValidState(codeList.state) && codeList.state !== 'Deleted'">
                                      <span>{{ codeList.name }}</span>
                                      <span class="f12 ml-auto pr-2"> ({{ codeList.versionId }}<span *ngIf="codeList.deprecated">, Deprecated</span><span *ngIf="codeList.state === 'Deleted'">, Deleted</span>)</span>
                                    </div>
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbiepDetail().bbie.valueDomainType === 'Agency'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbiepDetail().bbie.agencyIdListManifestId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Agency Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let agency of filteredValueDomains | async"
                                              [value]="agency.id">
                                    <div [class]="['d-flex']"
                                         [class.text-warning]="agency.state !== 'Deleted' && !isValidState(agency.state)"
                                         [class.text-danger]="agency.state === 'Deleted'"
                                         [class.text-line-through]="agency.state === 'Deleted'"
                                         [class.deprecated]="agency.deprecated"
                                         [matTooltip]="agency.state === 'Deleted' ? 'This agency ID list is deleted' : 'This agency ID list is usable but unstable'"
                                         [matTooltipDisabled]="isValidState(agency.state) && agency.state !== 'Deleted'">
                                      <span>{{ agency.name }}</span>
                                      <span class="f12 ml-auto pr-2"> ({{ agency.versionId }}<span *ngIf="agency.deprecated">, Deprecated</span><span *ngIf="agency.state === 'Deleted'">, Deleted</span>)</span>
                                    </div>
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                            </mat-card-content>
                          </mat-card>
                        </div>
                      </div>

                      <div class="pt-2 pb-2">
                        <mat-card>
                          <mat-card-subtitle>Facets</mat-card-subtitle>
                          <mat-card-content>
                            <div class="row">
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Minimum Length</mat-label>
                                  <input matInput placeholder="Minimum Length"
                                         [formControl]="facetMinimumLength">
                                  <mat-error
                                    *ngIf="!facetMinimumLength.hasError('min') && facetMinimumLength.hasError('pattern')">
                                    '{{ facetMinimumLength.value }}' is not allowed for Minimum Length
                                  </mat-error>
                                  <mat-error *ngIf="facetMinimumLength.hasError('min')">
                                    {{ facetMinimumLength.getError('min') }}
                                  </mat-error>
                                  <mat-error *ngIf="facetMinimumLength.hasError('max')">
                                    {{ facetMinimumLength.getError('max') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Maximum Length</mat-label>
                                  <input matInput placeholder="Maximum Length"
                                         [formControl]="facetMaximumLength">
                                  <mat-error
                                    *ngIf="!facetMaximumLength.hasError('min') && facetMaximumLength.hasError('pattern')">
                                    '{{ facetMaximumLength.value }}' is not allowed for Maximum Length
                                  </mat-error>
                                  <mat-error *ngIf="facetMaximumLength.hasError('min')">
                                    {{ facetMaximumLength.getError('min') }}
                                  </mat-error>
                                  <mat-error *ngIf="facetMaximumLength.hasError('max')">
                                    {{ facetMaximumLength.getError('max') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Pattern</mat-label>
                                  <input matInput placeholder="Pattern"
                                         [formControl]="facetPattern">
                                  <mat-error *ngIf="facetPattern.hasError('pattern')">
                                    {{ facetPattern.getError('pattern') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Pattern Test</mat-label>
                                  <input matInput placeholder="Pattern Test"
                                         [formControl]="facetPatternTest" [errorStateMatcher]="facetPatternTestErrorStateMatcher">
                                  <mat-error *ngIf="facetPatternTest.hasError('pattern')">
                                    The value '{{ facetPatternTest.getError('pattern').actualValue }}' does not satisfy the defined pattern '{{ facetPattern.value }}'.
                                  </mat-error>
                                  <mat-hint *ngIf="!!facetPatternTest.value && facetPatternTest.valid">
                                    The value '{{ facetPatternTest.value }}' matches the defined pattern '{{ facetPattern.value }}'.
                                  </mat-hint>
                                </mat-form-field>
                              </div>
                            </div>
                          </mat-card-content>
                        </mat-card>
                      </div>

                      <div class="row pt-2">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Context Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Context Definition"
                                        [(ngModel)]="asBbiepDetail().bbie.definition"
                                        [readonly]="!isEditable(selectedNode)">
                              </textarea>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Association Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Association Definition" [readonly]="true"
                                        value="{{ asBbiepDetail().bcc.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asBbiepDetail().bcc.definition, asBbiepDetail().bbie)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Component Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Component Definition" [readonly]="true"
                                        value="{{ asBbiepDetail().bccp.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asBbiepDetail().bccp.definition, asBbiepDetail().bbie)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>

              <!-- BBIE_SC -->
              <div class="bie-edit-detail-panel scroll" *ngIf="isBbieScDetail()">
                <mat-tab-group mat-align-tabs="start">
                  <mat-tab label="{{ selectedNode.name }}">
                    <div class="bie-edit-detail-container">
                      <div class="row align-items-center">
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [checked]="used(selectedNode)"
                                          (click)="toggleDetailUsed(selectedNode, $event)"
                                          [disabled]="!isUsable(selectedNode)"
                                          matTooltip="This component is required."
                                          [matTooltipDisabled]="!selectedNode.required">
                              Used
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3">
                          <div class="checkbox">
                            <mat-checkbox color="primary"
                                          [(ngModel)]="asBbieScDetail().bbieSc.deprecated"
                                          [matTooltip]="selectedNode.ccDeprecated ? 'Core Component is deprecated.' : ''"
                                          [disabled]="!isEditable(selectedNode) || selectedNode.ccDeprecated">
                              Deprecated
                            </mat-checkbox>
                          </div>
                        </div>
                        <div class="col-3"></div>
                        <div class="col-2"></div>
                        <div class="col-1">
                          <button mat-icon-button (click)="resetDetail(selectedNode)"
                                  *ngIf="state === 'WIP'"
                                  matTooltip="Reset detail"
                                  [disabled]="isUpdating || access !== 'CanEdit' || !selectedNode.used">
                            <mat-icon>refresh</mat-icon>
                          </button>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Min</mat-label>
                            <input matInput placeholder="Cardinality Min" required
                                   [formControl]="bieCardinalityMin">
                            <mat-error *ngIf="bieCardinalityMin.hasError('required') || bieCardinalityMin.hasError('whitespace')">
                              Cardinality Min is <strong>required</strong>
                            </mat-error>
                            <mat-error
                              *ngIf="!bieCardinalityMin.hasError('min') && bieCardinalityMin.hasError('pattern')">
                              '{{ bieCardinalityMin.value }}' is not allowed for Cardinality Min
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('min')">
                              Cardinality Min must be greater than or equals
                              to {{ asBbieScDetail().bbieSc.cardinalityMin }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMin.hasError('max')">
                              {{ bieCardinalityMin.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Cardinality Max</mat-label>
                            <input matInput placeholder="Cardinality Max (-1 for unbounded, Standard is {{ asBbieScDetail().bdtSc.cardinalityMax | unbounded}})" required
                                   [formControl]="bieCardinalityMax"
                                   [value]="bieCardinalityMax.value | unbounded">
                            <mat-hint *ngIf="bieCardinalityMax.valid && asBbieScDetail().bbieSc.cardinalityMax === 0 &&
                                            (!asBbieScDetail().bbieSc.definition || asBbieScDetail().bbieSc.definition === '')"
                                      style="color: #ff5722;">
                              Context Definition should define why Cardinality Max is zero (0)
                            </mat-hint>

                            <mat-error *ngIf="bieCardinalityMax.hasError('required') || bieCardinalityMax.hasError('whitespace')">
                              Cardinality Max is <strong>required</strong>
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('pattern')">
                              '{{ bieCardinalityMax.value }}' is not allowed for Cardinality Max
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('min')">
                              {{ bieCardinalityMax.getError('min') }}
                            </mat-error>
                            <mat-error *ngIf="bieCardinalityMax.hasError('max')">
                              {{ bieCardinalityMax.getError('max') }}
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Legacy Business Term</mat-label>
                            <input matInput placeholder="Legacy Business Term" maxlength="225"
                                   [(ngModel)]="asBbieScDetail().bbieSc.bizTerm"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-form-field>
                            <mat-label>Remark</mat-label>
                            <input matInput placeholder="Remark" maxlength="225"
                                   [(ngModel)]="asBbieScDetail().bbieSc.remark"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12 col-sm-12">
                          <mat-form-field>
                            <mat-label>Example</mat-label>
                            <input matInput placeholder="Example"
                                   [(ngModel)]="asBbieScDetail().bbieSc.example"
                                   [disabled]="!isEditable(selectedNode)">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row form-field-box">
                        <div class="col-md-6 col-sm-12">
                          <mat-card>
                            <mat-card-content
                              matTooltip="This value constraint cannot modify by the definition of the Business Information Entity."
                              [matTooltipDisabled]="!isReflectValue()">
                              <mat-form-field>
                                <mat-label>Value Constraint</mat-label>
                                <mat-select [(ngModel)]="asBbieScDetail().bbieSc.fixedOrDefault"
                                            [disabled]="!isEditable(selectedNode)||
                                                        isReflectValue()"
                                            (ngModelChange)="onChangeFixedOrDefault(asBbieScDetail().bbieSc.fixedOrDefault)">
                                  <mat-option value="none">None</mat-option>
                                  <mat-option value="fixed">Fixed Value</mat-option>
                                  <mat-option value="default">Default Value</mat-option>
                                </mat-select>
                              </mat-form-field>
                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.fixedOrDefault == 'none'">
                                <mat-label>No value constraints</mat-label>
                                <input matInput placeholder="No value constraints"
                                       [disabled]="true">
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.fixedOrDefault == 'fixed'">
                                <mat-label>Fixed Value</mat-label>
                                <input matInput placeholder="Fixed Value"
                                       [(ngModel)]="asBbieScDetail().bbieSc.fixedValue"
                                       [disabled]="!isEditable(selectedNode)||
                                                   isReflectValue()">
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.fixedOrDefault == 'default'">
                                <mat-label>Default Value</mat-label>
                                <input matInput placeholder="Default Value"
                                       [(ngModel)]="asBbieScDetail().bbieSc.defaultValue"
                                       [disabled]="!isEditable(selectedNode)||
                                                   isReflectValue()">
                              </mat-form-field>
                            </mat-card-content>
                          </mat-card>
                        </div>
                        <div class="col-md-6 col-sm-12">
                          <mat-card>
                            <mat-card-content>
                              <mat-form-field>
                                <mat-label>Value Domain Restriction</mat-label>
                                <mat-select placeholder="Value Domain Restriction" required
                                            [(ngModel)]="asBbieScDetail().bbieSc.valueDomainType"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option *ngFor="let valueDomainType of valueDomainTypes"
                                              [value]="valueDomainType.valueOf()">
                                    {{ valueDomainType.toString() | separate }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.valueDomainType === 'Primitive'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbieScDetail().bbieSc.bdtScPriRestriId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Primitive Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let xbt of filteredValueDomains | async"
                                              [value]="xbt.id">
                                    {{ xbt.name }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.valueDomainType === 'Code'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbieScDetail().bbieSc.codeListManifestId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Code Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let codeList of filteredValueDomains | async"
                                              [value]="codeList.id">
                                    <div [class]="['d-flex']"
                                         [class.text-warning]="codeList.state !== 'Deleted' && !isValidState(codeList.state)"
                                         [class.text-danger]="codeList.state === 'Deleted'"
                                         [class.text-line-through]="codeList.state === 'Deleted'"
                                         [class.deprecated]="codeList.deprecated"
                                         [matTooltip]="codeList.state === 'Deleted' ? 'This code list is deleted' : 'This code list is usable but unstable'"
                                         [matTooltipDisabled]="isValidState(codeList.state) && codeList.state !== 'Deleted'">
                                      <span>{{ codeList.name }}</span>
                                      <span class="f12 ml-auto pr-2"> ({{ codeList.versionId }}<span *ngIf="codeList.deprecated">, Deprecated</span><span *ngIf="codeList.state === 'Deleted'">, Deleted</span>)</span>
                                    </div>
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field *ngIf="asBbieScDetail().bbieSc.valueDomainType === 'Agency'">
                                <mat-label>Value Domain</mat-label>
                                <mat-select placeholder="Value Domain" required
                                            [(ngModel)]="asBbieScDetail().bbieSc.agencyIdListManifestId"
                                            (ngModelChange)="changeValueDomainType(selectedNode)"
                                            [disabled]="!isEditable(selectedNode)">
                                  <mat-option>
                                    <ngx-mat-select-search [formControl]="valueDomainFilterCtrl"
                                                           [placeholderLabel]="'Search...'"
                                                           [noEntriesFoundLabel]="'No matching Agency Value Domain found.'">
                                    </ngx-mat-select-search>
                                  </mat-option>

                                  <mat-option *ngFor="let agency of filteredValueDomains | async"
                                              [value]="agency.id">
                                    <div [class]="['d-flex']"
                                         [class.text-warning]="agency.state !== 'Deleted' && !isValidState(agency.state)"
                                         [class.text-danger]="agency.state === 'Deleted'"
                                         [class.text-line-through]="agency.state === 'Deleted'"
                                         [class.deprecated]="agency.deprecated"
                                         [matTooltip]="agency.state === 'Deleted' ? 'This agency ID list is deleted' : 'This agency ID list is usable but unstable'"
                                         [matTooltipDisabled]="isValidState(agency.state) && agency.state !== 'Deleted'">
                                      <span>{{ agency.name }}</span>
                                      <span class="f12 ml-auto pr-2"> ({{ agency.versionId }}<span *ngIf="agency.deprecated">, Deprecated</span><span *ngIf="agency.state === 'Deleted'">, Deleted</span>)</span>
                                    </div>
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                            </mat-card-content>
                          </mat-card>
                        </div>
                      </div>

                      <div class="pt-2 pb-2">
                        <mat-card>
                          <mat-card-subtitle>Facets</mat-card-subtitle>
                          <mat-card-content>
                            <div class="row">
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Minimum Length</mat-label>
                                  <input matInput placeholder="Minimum Length"
                                         [formControl]="facetMinimumLength">
                                  <mat-error
                                    *ngIf="!facetMinimumLength.hasError('min') && facetMinimumLength.hasError('pattern')">
                                    '{{ facetMinimumLength.value }}' is not allowed for Minimum Length
                                  </mat-error>
                                  <mat-error *ngIf="facetMinimumLength.hasError('min')">
                                    {{ facetMinimumLength.getError('min') }}
                                  </mat-error>
                                  <mat-error *ngIf="facetMinimumLength.hasError('max')">
                                    {{ facetMinimumLength.getError('max') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Maximum Length</mat-label>
                                  <input matInput placeholder="Maximum Length"
                                         [formControl]="facetMaximumLength">
                                  <mat-error
                                    *ngIf="!facetMaximumLength.hasError('min') && facetMaximumLength.hasError('pattern')">
                                    '{{ facetMaximumLength.value }}' is not allowed for Maximum Length
                                  </mat-error>
                                  <mat-error *ngIf="facetMaximumLength.hasError('min')">
                                    {{ facetMaximumLength.getError('min') }}
                                  </mat-error>
                                  <mat-error *ngIf="facetMaximumLength.hasError('max')">
                                    {{ facetMaximumLength.getError('max') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Pattern</mat-label>
                                  <input matInput placeholder="Pattern"
                                         [formControl]="facetPattern">
                                  <mat-error *ngIf="facetPattern.hasError('pattern')">
                                    {{ facetPattern.getError('pattern') }}
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-3">
                                <mat-form-field>
                                  <mat-label>Pattern Test</mat-label>
                                  <input matInput placeholder="Pattern Test"
                                         [formControl]="facetPatternTest">
                                  <mat-hint *ngIf="!!facetPatternTest.value && facetPatternTest.valid">
                                    The value '{{ facetPatternTest.value }}' matches the defined pattern '{{ facetPattern.value }}'.
                                  </mat-hint>
                                  <mat-error *ngIf="facetPatternTest.hasError('pattern')">
                                    The value '{{ facetPatternTest.getError('pattern').actualValue }}' does not satisfy the defined pattern '{{ facetPattern.value }}'.
                                  </mat-error>
                                </mat-form-field>
                              </div>
                            </div>
                          </mat-card-content>
                        </mat-card>
                      </div>

                      <div class="row pt-2">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Context Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Context Definition"
                                        [(ngModel)]="asBbieScDetail().bbieSc.definition"
                                        [readonly]="!isEditable(selectedNode)">
                              </textarea>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Component Definition</mat-label>
                            <div class="textarea-container">
                              <textarea matInput rows="6"
                                        placeholder="Component Definition" [readonly]="true"
                                        value="{{ asBbieScDetail().bdtSc.definition || ' ' }}">
                              </textarea>
                              <button mat-icon-button mat-small-icon-button *ngIf="used(selectedNode)"
                                      (click)="copyToDefinition(asBbieScDetail().bdtSc.definition, asBbieScDetail().bbieSc)"
                                      matTooltip="Copy to Context Definition">
                                <mat-icon>content_paste</mat-icon>
                              </button>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>
            </as-split-area>
          </as-split>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
