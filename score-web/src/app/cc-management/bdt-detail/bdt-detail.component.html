<mat-sidenav-container class="example-container" [hasBackdrop]="false">
  <mat-sidenav #sidenav [mode]="'over'" position="end" class="pd-15" >
    <div class="ui header">
      <h3 class="dividing">Comment</h3>
      <mat-icon class="close" (click)="commentControl.closeCommentSlide()">close</mat-icon>
    </div>
    <div class="ui feed">
      <div class="event" *ngFor="let comment of commentControl.comments" [class]="comment.isNew ? 'new-message': ''">
        <div class="content" [class]="comment.prevCommentId ? 'pl-4' : ''">
          <div class="summary">
            <a>{{ comment.loginId }}</a>
            <div class="date">{{ comment.timestamp | dateAgo }}</div>
            <mat-icon class="pointer icon"
                      *ngIf="comment.loginId === currentUser && !comment.hidden"
                      [inline]="true"
                      (click)="commentControl.deleteComment(comment)">close</mat-icon>
          </div>
          <div class="extra text">
            <div *ngIf="!comment.isEditing">
              <span *ngIf="!comment.hidden">{{ comment.text }}</span>
              <span *ngIf="comment.hidden" class="text-muted">(This message has been deleted.)</span>
              <mat-icon class="pointer icon mt-1"
                        *ngIf="comment.loginId === currentUser && !comment.hidden"
                        [inline]="true"
                        (click)="commentControl.openEditComment(comment)">edit</mat-icon>
            </div>
            <div *ngIf="comment.isEditing">
              <mat-form-field>
                <textarea matInput rows="3" [(ngModel)]="comment.textTemp"></textarea>
              </mat-form-field>
              <button mat-stroked-button (click)="commentControl.editComment(comment)">Edit</button>&nbsp;
              <button mat-stroked-button (click)="commentControl.cancelEditComment(comment)">Cancel</button>
            </div>
          </div>
          <div class="meta" *ngIf="comment.prevCommentId === null && commentControl.replyCommentId !== comment.commentId">
            <a class="like" (click)="commentControl.openReply(comment)">Reply</a>
          </div>
          <div class="reply-box" *ngIf="commentControl.replyCommentId === comment.commentId">
            <mat-form-field>
              <textarea matInput rows="3" [(ngModel)]="commentControl.replyMessage"></textarea>
            </mat-form-field>
            <button mat-stroked-button (click)="commentControl.addComment(comment)">Reply</button>&nbsp;
            <button mat-stroked-button (click)="commentControl.closeReply()">Cancel</button>
          </div>
        </div>
      </div>
      <div *ngIf="commentControl.replyOpened === false">
        <mat-form-field>
          <textarea matInput rows="3" [(ngModel)]="commentControl.commentMessage"></textarea>
        </mat-form-field>
        <button mat-stroked-button (click)="commentControl.addComment()">
          Comment
        </button>
      </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content (click)="sidenav.close();">
    <div class="cdk-overlay-backdrop cdk-overlay-dark-backdrop cdk-overlay-backdrop-showing" *ngIf="isUpdating">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
    <div class="context-section">
      <div class="row m-0">
        <div class="col-12 p-0">
          <mat-card class="search-box-container mb-1">
            <mat-card-content>
              <div class="container-fluid" *ngIf="searcher && dataSource">
                <div class="row">
                  <div class="col-5 tree-search-box">
                    <div class="row">
                      <div class="col-9">
                        <mat-form-field>
                          <mat-placeholder *ngIf="!selectedNode">Search</mat-placeholder>
                          <mat-placeholder *ngIf="selectedNode">Search > {{selectedNode.name}}</mat-placeholder>
                          <input matInput type="search" [(ngModel)]="searcher.inputKeyword"
                                 [disabled]="searcher.isSearching"
                                 (keyup.enter)="search(searcher.inputKeyword)">
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && searcher.searchResult.length > 0"
                                    align="end">{{searcher.searchIndex + 1}}/{{searcher.searchResult.length}} in {{ searcher.searchedItemCount }}{{ searcher.fullSearched ? '' : '+' }} nodes</mat-hint>
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && !searcher.fullSearched && searcher.searchResult.length === 0"
                                    align="end">0 results in {{ searcher.searchedItemCount }} nodes</mat-hint>
                          <mat-hint matSuffix *ngIf="searcher.searchKeyword && searcher.fullSearched && searcher.searchResult.length === 0"
                                    align="end">0 results</mat-hint>
                        </mat-form-field>
                      </div>
                      <div class="col-3 buttons">
                        <button mat-icon-button
                                [disabled]="searcher.isSearching || !searcher.searchResult || searcher.searchResult.length === 0"
                                (click)="move(-1)">
                          <mat-icon>keyboard_arrow_up</mat-icon>
                        </button>
                        <button mat-icon-button
                                [disabled]="searcher.isSearching || !searcher.searchResult || searcher.searchResult.length === 0"
                                (click)="move(1)">
                          <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <button mat-icon-button
                                [hidden]="searcher.fullSearched"
                                [disabled]="searcher.isSearching"
                                [matTooltip]="(searcher.searchKeyword && !searcher.fullSearched) ? 'Search more...' : 'Search'"
                                (click)="search(searcher.inputKeyword, false, true)">
                          <mat-icon>{{ (searcher.searchKeyword && !searcher.fullSearched) ? 'repeat' : 'search' }}</mat-icon>
                        </button>
                        <button mat-icon-button
                                [disabled]="searcher.isSearching"
                                [hidden]="!searcher.inputKeyword"
                                (click)="searcher.inputKeyword = ''; searcher.resetSearch()">
                          <mat-icon>close</mat-icon>
                        </button>
                        <div style="height: 19px;">
                          <mat-progress-spinner mode="indeterminate" [diameter]="15" class="search-progress-bar"
                                                [hidden]="!searcher.isSearching"></mat-progress-spinner>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-7 actions-wrap">
                    <div class="actions ml-auto" *ngIf="isWorkingRelease()">
                      <button mat-icon-button [id]="'cc-settings'"
                              [matMenuTriggerFor]="settingsContextMenu"
                              [matMenuTriggerData]="{'menuId': 'settingsContextMenu'}">
                        <mat-icon>settings</mat-icon>
                      </button>
                      <button mat-raised-button color="primary" (click)="updateDetails()"
                              *ngIf="state === 'WIP' && access === 'CanEdit'"
                              [disabled]="updateDisabled">
                        Update
                      </button>
                      <button mat-raised-button color="accent" (click)="updateState('Draft')"
                              *ngIf="state === 'WIP' && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating || isChanged || !isEditable()">
                        Move to Draft
                      </button>
                      <button mat-raised-button color="warn" (click)="updateState('WIP')"
                              *ngIf="(state === 'Draft' || state === 'Candidate') && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating">
                        Back to WIP
                      </button>
                      <button mat-raised-button color="accent" (click)="updateState('Candidate')"
                              *ngIf="state === 'Draft' && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating">
                        Move to Candidate
                      </button>
                      <button mat-raised-button color="warn" (click)="makeNewRevision()"
                              *ngIf="state === 'Published' && userRoles.includes('developer') && (access === 'CanMove' || access === 'CanEdit') && rootNode.basedManifestId"
                              [disabled]="isUpdating">
                        {{ userRoles.includes('developer') ? 'Revise' : 'Amend' }}
                      </button>
                      <button mat-raised-button color="warn" (click)="deleteNode()"
                              *ngIf="state === 'WIP' && !hasRevision() && access === 'CanEdit'"
                              [disabled]="isUpdating || isChanged">
                        Delete
                      </button>
                      <button mat-raised-button color="warn" (click)="purgeNode()"
                              *ngIf="state === 'Deleted' && (access === 'CanMove' || access === 'CanEdit')">
                        Purge
                      </button>
                      <button mat-raised-button color="primary" (click)="restoreNode()"
                              *ngIf="state === 'Deleted' && (access === 'CanMove' || access === 'CanEdit')">
                        Restore
                      </button>
                      <button mat-raised-button color="primary" (click)="cancelRevision()"
                              *ngIf="state === 'WIP' && hasRevision() && access === 'CanEdit'">
                        Cancel
                      </button>
                    </div>
                    <div class="actions ml-auto" *ngIf="!isWorkingRelease()">
                      <button mat-icon-button [id]="'cc-settings'"
                              [matMenuTriggerFor]="settingsContextMenu"
                              [matMenuTriggerData]="{'menuId': 'settingsContextMenu'}">
                        <mat-icon>settings</mat-icon>
                      </button>
                      <button mat-raised-button color="primary" (click)="updateDetails()"
                              *ngIf="state === 'WIP' && access === 'CanEdit'"
                              [disabled]="!isChanged">
                        Update
                      </button>
                      <button mat-raised-button color="accent" (click)="updateState('QA')"
                              *ngIf="state === 'WIP' && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating || isChanged || !isEditable()">
                        Move to QA
                      </button>
                      <button mat-raised-button color="warn" (click)="updateState('WIP')"
                              *ngIf="state === 'QA' && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating">
                        Back to WIP
                      </button>
                      <button mat-raised-button color="accent" (click)="updateState('Production')"
                              *ngIf="state === 'QA' && (access === 'CanMove' || access === 'CanEdit')"
                              [disabled]="isUpdating">
                        Move to Production
                      </button>
                      <button mat-raised-button color="warn" (click)="makeNewRevision()"
                              *ngIf="state === 'Production' && !userRoles.includes('developer') && (access === 'CanMove' || access === 'CanEdit') && rootNode.basedManifestId"
                              [disabled]="isUpdating">
                        {{ userRoles.includes('developer') ? 'Revise' : 'Amend' }}
                      </button>
                      <button mat-raised-button color="warn" (click)="deleteNode()"
                              *ngIf="state === 'WIP' && !hasRevision() && access === 'CanEdit'"
                              [disabled]="isUpdating || isChanged">
                        Delete
                      </button>
                      <button mat-raised-button color="primary" (click)="restoreNode()"
                              *ngIf="state === 'Deleted' && (access === 'CanMove' || access === 'CanEdit')">
                        Restore
                      </button>
                      <button mat-raised-button color="primary" (click)="cancelRevision()"
                              *ngIf="state === 'WIP' && hasRevision() && access === 'CanEdit'">
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
                <mat-menu class="context-menu" #settingsContextMenu="matMenu">
                  <button mat-menu-item [id]="'cc-settings-hide-cardinality'">
                    <mat-checkbox class="d-inline-flex pr-2" [(ngModel)]="hideCardinality">
                      <span>Hide cardinality</span>
                    </mat-checkbox>
                  </button>
                  <button mat-menu-item [id]="'bie-settings-hide-unused'">
                    <mat-checkbox class="d-inline-flex pr-2" [(ngModel)]="hideProhibited">
                      <span>Hide Prohibited SCs</span>
                    </mat-checkbox>
                  </button>
                </mat-menu>
                <div class="row">
                  <div class="tree-breadcrumbs-wrap" id="cc-tree-breadcrumbs-wrap" *ngIf="selectedNode">
                    <div class="tree-breadcrumb"
                         *ngFor="let bread of selectedNode.parents; let last = last;">
                      <span aria-hidden="true" class="tree-breadcrumb-separator">/</span>
                      <span *ngIf="last"
                            class="tree-breadcrumb-item-last">{{ bread.name }} {{ last ? scrollBreadcrumb('cc-tree-breadcrumbs-wrap') : '' }}</span>
                      <span *ngIf="!last" class="tree-breadcrumb-item"
                            (click)="scrollToNode(bread)">{{ bread.name }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div class="row m-0" (window:resize)="onResize($event)">
        <div class="col-12 p-0">
          <as-split unit="percent" [direction]="'horizontal'">
            <as-split-area class="left-panel" size="30">
              <mat-card class="cc-node-tree-panel">
                <mat-card-content class="mat-card-container">
                  <cdk-virtual-scroll-viewport itemSize="{{ virtualScrollItemSize }}" minBufferPx="{{ minBufferPx }}" maxBufferPx="{{ maxBufferPx }}"
                                               [style.height.px]="innerHeight" #virtualScroll>
                    <div *cdkVirtualFor="let node of dataSource" class="example-item"
                         (mouseover)="node.showCopyLinkIcon = true" (mouseout)="node.showCopyLinkIcon = false">
                      <div class="mat-tree-node d-flex pointer"
                           tabIndex="0"
                           [class]="{'tree-node-selected': cursorNode === node}"
                           (click)="onClick(node, $event)"
                           (keydown)="keyNavigation(node, $event)"
                           [matTooltip]="'Circular reference detected.'"
                           [matTooltipDisabled]="!node.isCycle"
                           [style.padding-left]="node.level * paddingPixel + 'px'">
                        <button *ngIf="dataSource.isExpandable(node); else disabledRef;"
                                (click)="toggle(node, $event)"
                                class="align-self-center"
                                mat-icon-button>
                          <mat-icon class="mat-icon-rtl-mirror" *ngIf="dataSource.isExpandable(node)">
                            {{ dataSource.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
                          </mat-icon>
                        </button>
                        <ng-template #disabledRef>
                          <button mat-icon-button disabled></button>
                        </ng-template>

                        <span [class]="['pr-2', 'align-self-center', node.typeClass.toLowerCase(),
                              node.deprecated ? 'deprecated' : 'dummy',
                              node.inhibited ? 'inhibited' : 'dummy',
                              this.searcher.searchResult.indexOf(node) > -1 ? 'inside' : 'outside',
                              this.searcher.searchResult.indexOf(node) === this.searcher.searchIndex ? 'search-index' : 'asd',
                              node.state === 'Deleted' ? 'text-line-through' : 'text-none']"
                              [matTooltip]="node.state === 'Deleted' ? 'Deleted' : (node.deprecated ? 'Deprecated' : '')"
                              [innerHTML]="node.name | highlight : searcher.searchKeyword">
                        </span>

                        <span [class]="['pl-2', 'align-self-center']"
                              *ngIf="!dataSource.hideCardinality && node.cardinalityMin !== undefined && node.cardinalityMax !== undefined">
                          {{ node.cardinalityMin + '..' + ((node.cardinalityMax === -1) ? '&infin;' : node.cardinalityMax) }}
                        </span>

                        <div class="tag-list pl-2 align-self-center">
                            <span class="tag ml-2" *ngFor="let tag of node.tagList"
                                  [style.background-color]="tag.backgroundColor"
                                  [style.color]="tag.textColor">{{ tag.name }}</span>
                        </div>

                        <div class="ml-auto align-self-center mr-2">
                          <mat-icon [hidden]="!node.showCopyLinkIcon"
                                    matTooltip="Copy Link"
                                    (click)="copyLink(node, $event)">
                            link
                          </mat-icon>
                          <mat-icon [style.visibility]="!node.isCycle ? '' : 'hidden'"
                                    [matMenuTriggerFor]="contextMenu"
                                    [matMenuTriggerData]="{'menuId': 'contextMenu'}"
                                    (click)="contextMenuItem = node; $event.stopPropagation();">more_vert
                          </mat-icon>
                        </div>
                      </div>
                    </div>
                  </cdk-virtual-scroll-viewport>

                  <mat-menu class="context-menu" #contextMenu="matMenu">
                    <button mat-menu-item (click)="dataSource.expandDescendants(contextMenuItem, 2)">
                      <span class="context-menu-item">Expand 2</span>
                    </button>
                    <button mat-menu-item (click)="dataSource.expandDescendants(contextMenuItem, 3)">
                      <span class="context-menu-item">Expand 3</span>
                    </button>
                    <mat-divider *ngIf="!!contextMenuItem && isEditable()"></mat-divider>
                    <button mat-menu-item (click)="appendSc(contextMenuItem)"
                            *ngIf="!!contextMenuItem && contextMenuItem.level === 0 && isEditable()">
                      <span class="context-menu-item">Add Supplementary Component</span>
                    </button>
                    <button mat-menu-item (click)="discardSc(contextMenuItem)"
                            *ngIf="!!contextMenuItem && contextMenuItem.level === 1 && isEditable() && canDiscard(contextMenuItem)">
                      <span class="context-menu-item">Remove</span>
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item (click)="openCoreComponent(contextMenuItem)"
                            *ngIf="!!contextMenuItem && contextMenuItem.level !== 0">
                      <span class="context-menu-item">Open in new tab</span>
                    </button>
                    <button mat-menu-item (click)="openHistory(contextMenuItem)">
                      <span class="context-menu-item">Show History</span>
                    </button>
                    <button mat-menu-item (click)="openComments(contextMenuItem.type, contextMenuItem)">
                      <span class="context-menu-item">Comments</span>
                    </button>
                    <button mat-menu-item [matMenuTriggerFor]="editTagsSubMenu">Tags</button>
                  </mat-menu>

                  <mat-menu #editTagsSubMenu="matMenu">
                    <button mat-menu-item *ngFor="let tag of tags" (click)="toggleTag(contextMenuItem, tag)">
                      <mat-icon>{{ contains(contextMenuItem, tag) ? 'check' : '' }}</mat-icon>
                      <span>{{ tag.name }}</span>
                    </button>
                    <mat-divider *ngIf="tags.length > 0"></mat-divider>
                    <button mat-menu-item (click)="openEditTags()">
                      <mat-icon>edit</mat-icon>
                      <span>Edit Tags</span>
                    </button>
                  </mat-menu>
                </mat-card-content>
              </mat-card>
            </as-split-area>
            <as-split-area class="right-panel" size="70" [style.height.px]="innerHeight + 17">

              <!-- BCC & BCCP & BDT -->
              <div class="cc-node-detail-panel" *ngIf="isBdtDetail()">
                <mat-tab-group mat-align-tabs="start" animationDuration="0ms">
                  <mat-tab label="{{ asBdtDetail().den }}">
                    <div class="cc-node-detail-container">
                      <div class="row">
                        <div class="col-2">
                          <mat-form-field matTooltip="Data Type">
                            <mat-label>Core Component</mat-label>
                            <input matInput *ngIf="!rootNode.basedManifestId" value="CDT" [disabled]="true">
                            <input matInput *ngIf="rootNode.basedManifestId" value="BDT" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Release</mat-label>
                            <input matInput [(ngModel)]="asBdtDetail().releaseNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="{{ asBdtDetail().lastChangedManifestId > 0 ? 'col-1' : 'col-2' }}">
                          <mat-form-field>
                            <mat-label>Since</mat-label>
                            <a [routerLink]="['/core_component/dt/' + asBdtDetail().sinceManifestId]"
                               target="_blank" rel="noopener noreferrer">
                              <input matInput [(ngModel)]="asBdtDetail().sinceReleaseNum" [disabled]="true" style="cursor: pointer;">
                            </a>
                          </mat-form-field>
                        </div>
                        <div class="col-1" *ngIf="asBdtDetail().lastChangedManifestId > 0">
                          <mat-form-field>
                            <mat-label>Last Changed</mat-label>
                            <a [routerLink]="['/core_component/dt/' + asBdtDetail().lastChangedManifestId]"
                               target="_blank" rel="noopener noreferrer">
                              <input matInput [(ngModel)]="asBdtDetail().lastChangedReleaseNum" [disabled]="true" style="cursor: pointer;">
                            </a>
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Revision</mat-label>
                            <input matInput [(ngModel)]="asBdtDetail().revisionNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>State</mat-label>
                            <input matInput [(ngModel)]="asBdtDetail().state" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Owner</mat-label>
                            <input matInput [(ngModel)]="asBdtDetail().owner" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>GUID</mat-label>
                            <input matInput maxlength="41"
                                   [(ngModel)]="asBdtDetail().guid" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>{{ 'DATA_TYPE_DETAIL.DEN' | translate }}</mat-label>
                            <input matInput maxlength="200"
                                   [(ngModel)]="asBdtDetail().den" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Based Data Type</mat-label>
                            <input matInput maxlength="200"
                                   [(ngModel)]="asBdtDetail().basedBdtDen" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <input matInput placeholder="Data Type Term" maxlength="45"
                                   [(ngModel)]="asBdtDetail().dataTypeTerm" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <input matInput placeholder="Representation Term" maxlength="100"
                                   [(ngModel)]="asBdtDetail().representationTerm" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field *ngIf="selectedNode.level === 0 && isEditable() && !hasRevision()">
                            <mat-select placeholder="Namespace"
                                        [(ngModel)]="asBdtDetail().namespaceId"
                                        [required]="true">
                              <mat-option>
                                <ngx-mat-select-search [formControl]="namespaceListFilterCtrl"
                                                       [placeholderLabel]="'Search...'"
                                                       [noEntriesFoundLabel]="'No matching namespace found.'"></ngx-mat-select-search>
                              </mat-option>
                              <mat-option *ngFor="let namespace of filteredNamespaceList | async" [value]="namespace.namespaceId">
                                {{ namespace.uri }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                          <mat-form-field *ngIf="selectedNode.level !== 0 || !isEditable() || hasRevision()">
                            <mat-select placeholder="Namespace"
                                        [(ngModel)]="asBdtDetail().namespaceId"
                                        [required]="true"
                                        [disabled]="true">
                              <mat-option *ngFor="let namespace of getSelectableNamespaces(asBdtDetail().namespaceId)"
                                          [value]="namespace.namespaceId">{{ namespace.uri }}</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <mat-form-field>
                            <input matInput placeholder="Qualifier" maxlength="100"
                                   [(ngModel)]="asBdtDetail().qualifier"
                                   [disabled]="!isEditable() || hasRevision()"/>
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>Six Hexadecimal Identifier</mat-label>
                            <input matInput placeholder="Six Hexadecimal Identifier" maxlength="100"
                                   [(ngModel)]="asBdtDetail().sixDigitId" [disabled]="true">
                            <button matSuffix mat-icon-button aria-label="{{ isEmpty(asBdtDetail().sixDigitId) ? 'Generate' : 'Renew' }}"
                                    matTooltip="{{ isEmpty(asBdtDetail().sixDigitId) ? 'Generate' : 'Renew' }}"
                                    *ngIf="!hasRevision()"
                                    [disabled]="!isEditable() || hasRevision()"
                                    (click)="asBdtDetail().sixDigitId = randSixDigitId()">
                              <mat-icon>autorenew</mat-icon>
                            </button>
                            <button matSuffix mat-icon-button aria-label="Clear"
                                    matTooltip="Clear"
                                    *ngIf="!hasRevision()"
                                    [disabled]="!isEditable() || hasRevision() || isEmpty(asBdtDetail().sixDigitId)"
                                    (click)="asBdtDetail().sixDigitId = undefined">
                              <mat-icon>clear</mat-icon>
                            </button>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12 pb-3">
                          <mat-expansion-panel #dtValueDomain style="margin-bottom: 8px !important;">
                            <mat-expansion-panel-header>
                              <mat-panel-title>Value Domain</mat-panel-title>
                              <mat-panel-description *ngIf="!dtValueDomain.expanded && asBdtDetail().defaultValueDomain !== undefined">
                                <span>Default - {{ asBdtDetail().defaultValueDomain.name }}</span>
                              </mat-panel-description>
                            </mat-expansion-panel-header>
                            <mat-action-row *ngIf="hasTokenPrimitive(asBdtDetail()) && isEditable()">
                              <button mat-stroked-button class="ml-auto" matTooltip="Add Value Domain"
                                      [disabled]="!isEditable()"
                                      (click)="addValueDomain(asBdtDetail())">Add
                              </button>
                              <button mat-stroked-button class="ml-2" matTooltip="Discard Value Domain"
                                      [disabled]="!selectedValueDomain || selectedValueDomain.default || selectedValueDomain.inherited"
                                      (click)="deleteValueDomain(asBdtDetail())">Discard
                              </button>
                            </mat-action-row>
                            <table mat-table [dataSource]="restrictionDataSource">
                              <!-- Checkbox Column -->
                              <ng-container matColumnDef="select">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let row">
                                  <mat-checkbox (click)="$event.stopPropagation()"
                                                [disabled]="!isEditable() || row.type === 'Primitive' || row.bdtPriRestri.inherited"
                                                (change)="$event ? toggleValueDomain(row) : null"
                                                [checked]="isSelected(row)">
                                  </mat-checkbox>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="type">
                                <th mat-header-cell *matHeaderCellDef> Value Domain Type</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.type">
                                      <mat-option *ngFor="let type of [element.type,]" [value]="type"
                                                  [disabled]="true">{{ type }}</mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type !== 'Primitive'">
                                    <mat-select [(ngModel)]="element.type"
                                                (ngModelChange)="onChangeValueDomain(asBdtDetail())">
                                      <mat-option *ngFor="let type of ['CodeList', 'AgencyIdList']" [value]="type"
                                                  [disabled]="!isEditable() || element.bdtPriRestri.inherited">
                                        {{ (type === 'CodeList') ? 'Code List' : 'Agency ID List' }}</mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef> Name</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.name">
                                      <mat-option *ngFor="let primitive of primitiveList" [value]="primitive" [disabled]="true">
                                        <span>{{ primitive }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type === 'CodeList'">
                                    <mat-select [(ngModel)]="element.bdtPriRestri.selectedCodeList"
                                                [required]="true"
                                                (ngModelChange)="onChangeValueDomain(asBdtDetail())">
                                      <mat-option *ngFor="let codeList of filteredCodeLists(element)" [value]="codeList"
                                                  [disabled]="!isEditable() || element.bdtPriRestri.inherited">
                                        <span class="{{ codeList.state === 'Deleted' ? 'text-line-through' : '' }}">{{ codeList.codeListName }}</span>
                                        <span class="f12 ml-auto"> ({{ codeList.versionId }}<span *ngIf="codeList.deprecated">, Deprecated</span><span *ngIf="codeList.state === 'Deleted'">, Deleted</span>)</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type === 'AgencyIdList'">
                                    <mat-select [(ngModel)]="element.bdtPriRestri.selectedAgencyIdList"
                                                [required]="true"
                                                (ngModelChange)="onChangeValueDomain(asBdtDetail())">
                                      <mat-option *ngFor="let agencyIdList of filteredAgencyIdLists(element)" [value]="agencyIdList"
                                                  [disabled]="!isEditable() || element.bdtPriRestri.inherited">
                                        <span>{{ agencyIdList.name }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="xbt">
                                <th mat-header-cell *matHeaderCellDef> XSD Expression</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.xbtList" multiple>
                                      <mat-option *ngFor="let xbt of element.xbtList" [value]="xbt" [disabled]="true">
                                        <span>{{ xbt }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <tr mat-header-row *matHeaderRowDef="restrictionListDisplayedColumns"></tr>
                              <tr mat-row *cdkRowDef="let row; columns: restrictionListDisplayedColumns;"></tr>
                            </table>
                            <mat-toolbar>
                              <mat-toolbar-row>
                                <mat-form-field class="pt-2 w-50 pl-2">
                                  <mat-label>Default</mat-label>
                                  <mat-select [(ngModel)]="asBdtDetail().defaultValueDomain">
                                    <mat-optgroup *ngFor="let valueDomain of asBdtDetail().bdtPriRestriListByGroup"
                                                  [label]="valueDomain.label">
                                      <mat-option *ngFor="let item of valueDomain.list" [value]="item" [disabled]="!isEditable()">
                                        {{ (item.type === 'Primitive') ? item.self.primitiveName + ' - ' + item.name : item.name }}
                                      </mat-option>
                                    </mat-optgroup>
                                  </mat-select>
                                </mat-form-field>
                              </mat-toolbar-row>
                            </mat-toolbar>
                          </mat-expansion-panel>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <input matInput placeholder="Definition Source" maxlength="200"
                                   [(ngModel)]="asBdtDetail().definitionSource" [disabled]="!isEditable()">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <textarea matInput rows="6" cols="30"
                                      placeholder="Definition"
                                      [(ngModel)]="asBdtDetail().definition"
                                      [disabled]="!isEditable()"></textarea>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <textarea matInput rows="6" cols="30"
                                      placeholder="Content Component Definition"
                                      [(ngModel)]="asBdtDetail().contentComponentDefinition"
                                      [disabled]="!isEditable()"></textarea>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>

              <!-- BDT_SC -->
              <div class="cc-node-detail-panel" *ngIf="isBdtScDetail()">
                <mat-tab-group mat-align-tabs="start" animationDuration="0ms">
                  <mat-tab label="{{ asBdtScDetail().den }}">
                    <div class="cc-node-detail-container">
                      <div class="row">
                        <div class="col-2">
                          <mat-form-field matTooltip="Data Type Supplementary Component">
                            <mat-label>Core Component</mat-label>
                            <input matInput value="DTSC" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Release</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().releaseNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="{{ asBdtScDetail().lastChangedManifestId > 0 ? 'col-1' : 'col-2' }}">
                          <mat-form-field>
                            <mat-label>Since</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().sinceReleaseNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-1" *ngIf="asBdtScDetail().lastChangedManifestId > 0">
                          <mat-form-field>
                            <mat-label>Last Changed</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().lastChangedReleaseNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Revision</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().revisionNum" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>State</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().state" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-2">
                          <mat-form-field>
                            <mat-label>Owner</mat-label>
                            <input matInput [(ngModel)]="asBdtScDetail().owner" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row" *ngIf="!asBdtScDetail().spec">
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>GUID</mat-label>
                            <input matInput maxlength="41"
                                   [(ngModel)]="asBdtScDetail().guid" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-6">
                          <mat-form-field>
                            <mat-label>{{ 'BDT_SC_DETAIL.DEN' | translate }}</mat-label>
                            <input matInput maxlength="200"
                                   [(ngModel)]="asBdtScDetail().den" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row" *ngIf="asBdtScDetail().spec">
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>GUID</mat-label>
                            <input matInput maxlength="41"
                                   [(ngModel)]="asBdtScDetail().guid" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Specification</mat-label>
                            <input matInput maxlength="41"
                                   [(ngModel)]="asBdtScDetail().spec" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>{{ 'BDT_SC_DETAIL.DEN' | translate }}</mat-label>
                            <input matInput maxlength="200"
                                   [(ngModel)]="asBdtScDetail().den" [disabled]="true">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Object Class Term</mat-label>
                            <input matInput maxlength="60"
                                   [(ngModel)]="asBdtScDetail().objectClassTerm" [disabled]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Property Term</mat-label>
                            <input matInput maxlength="60"
                                   [(ngModel)]="asBdtScDetail().propertyTerm"
                                   [disabled]="!isEditable() || asBdtScDetail().cardinality === 'Prohibited' || asBdtScDetail().basedDtScId > 0"
                                   [required]="true">
                          </mat-form-field>
                        </div>
                        <div class="col-4">
                          <mat-form-field>
                            <mat-label>Representation Term</mat-label>
                            <mat-select [(ngModel)]="asBdtScDetail().representationTerm"
                                        (ngModelChange)="loadDefaultPrimitiveValues(asBdtScDetail())"
                                        [disabled]="!isEditable() || asBdtScDetail().cardinality === 'Prohibited' || asBdtScDetail().basedDtScId > 0"
                                        [required]="true">
                              <mat-option value="" *ngIf="asBdtScDetail().representationTerm === ''"></mat-option>
                              <mat-option value="Amount">Amount</mat-option>
                              <mat-option value="Binary Object">Binary Object</mat-option>
                              <mat-option value="Code">Code</mat-option>
                              <mat-option value="Date">Date</mat-option>
                              <mat-option value="Date Time">Date Time</mat-option>
                              <mat-option value="Duration">Duration</mat-option>
                              <mat-option value="Graphic">Graphic</mat-option>
                              <mat-option value="Identifier">Identifier</mat-option>
                              <mat-option value="Indicator">Indicator</mat-option>
                              <mat-option value="Measure">Measure</mat-option>
                              <mat-option value="Name">Name</mat-option>
                              <mat-option value="Number">Number</mat-option>
                              <mat-option value="Ordinal">Ordinal</mat-option>
                              <mat-option value="Percent">Percent</mat-option>
                              <mat-option value="Picture">Picture</mat-option>
                              <mat-option value="Quantity">Quantity</mat-option>
                              <mat-option value="Rate">Rate</mat-option>
                              <mat-option value="Ratio">Ratio</mat-option>
                              <mat-option value="Sound">Sound</mat-option>
                              <mat-option value="Text">Text</mat-option>
                              <mat-option value="Time">Time</mat-option>
                              <mat-option value="Value">Value</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <mat-label>Cardinality</mat-label>
                            <mat-select [(ngModel)]="asBdtScDetail().cardinality"
                                        [disabled]="!isEditable() || !asBdtScDetail().isCardinalityEditable">
                              <mat-option *ngFor="let option of asBdtScDetail().allowedCardinalities"
                                          [value]="option.value" [disabled]="option.disabled">{{option.value}}</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-3 col-sm-3">
                          <mat-form-field>
                            <mat-label>Value Constraint</mat-label>
                            <mat-select [(ngModel)]="asBdtScDetail().fixedOrDefault"
                                        [disabled]="!isEditable() || asBdtScDetail().cardinality === 'Prohibited'">
                              <mat-option value="none">None</mat-option>
                              <mat-option value="fixed">Fixed Value</mat-option>
                              <mat-option value="default">Default Value</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                        <div class="col-md-9 col-sm-9">
                          <mat-form-field *ngIf="asBdtScDetail().fixedOrDefault == 'none'">
                            <input matInput placeholder="No value constraints"
                                   [disabled]="true">
                          </mat-form-field>

                          <mat-form-field *ngIf="asBdtScDetail().fixedOrDefault == 'fixed'">
                            <input matInput placeholder="Fixed Value"
                                   [(ngModel)]="asBdtScDetail().fixedValue"
                                   [disabled]="!isEditable()">
                          </mat-form-field>

                          <mat-form-field *ngIf="asBdtScDetail().fixedOrDefault == 'default'">
                            <input matInput placeholder="Default Value"
                                   [(ngModel)]="asBdtScDetail().defaultValue"
                                   [disabled]="!isEditable()">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12 pb-3">
                          <mat-expansion-panel #dtScValueDomain style="margin-bottom: 8px !important;">
                            <mat-expansion-panel-header>
                              <mat-panel-title>Value Domain</mat-panel-title>
                              <mat-panel-description *ngIf="!dtScValueDomain.expanded && asBdtScDetail().defaultValueDomain !== undefined">
                                <span>Default - {{ asBdtScDetail().defaultValueDomain.name }}</span>
                              </mat-panel-description>
                            </mat-expansion-panel-header>
                            <mat-action-row *ngIf="hasTokenPrimitive(asBdtScDetail()) && isEditable()">
                              <button mat-stroked-button class="ml-auto" matTooltip="Add Value Domain"
                                      [disabled]="!isEditable()"
                                      (click)="addValueDomain(asBdtScDetail())">Add
                              </button>
                              <button mat-stroked-button class="ml-2" matTooltip="Discard Value Domain"
                                      [disabled]="!selectedValueDomain || selectedValueDomain.default || selectedValueDomain.inherited"
                                      (click)="deleteValueDomain(asBdtScDetail())">Discard</button>
                            </mat-action-row>
                            <table mat-table [dataSource]="restrictionDataSource">
                              <!-- Checkbox Column -->
                              <ng-container matColumnDef="select">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let row">
                                  <mat-checkbox (click)="$event.stopPropagation()"
                                                [disabled]="!isEditable() || row.type === 'Primitive' || row.bdtScPriRestri.inherited"
                                                (change)="$event ? toggleValueDomain(row) : null"
                                                [checked]="isSelected(row)">
                                  </mat-checkbox>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="type">
                                <th mat-header-cell *matHeaderCellDef> Value Domain Type</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.type">
                                      <mat-option *ngFor="let type of [element.type,]" [value]="type"
                                                  [disabled]="true">{{ type }}</mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type !== 'Primitive'">
                                    <mat-select [(ngModel)]="element.type"
                                                (ngModelChange)="onChangeValueDomain(asBdtScDetail())">
                                      <mat-option *ngFor="let type of ['CodeList', 'AgencyIdList']" [value]="type"
                                                  [disabled]="!isEditable() || element.bdtScPriRestri.inherited">
                                        {{ (type === 'CodeList') ? 'Code List' : 'Agency ID List' }}</mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef> Name</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.name">
                                      <mat-option *ngFor="let primitive of primitiveList" [value]="primitive" [disabled]="true">
                                        <span>{{ primitive }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type === 'CodeList'">
                                    <mat-select [(ngModel)]="element.bdtScPriRestri.selectedCodeList"
                                                [required]="true"
                                                (ngModelChange)="onChangeValueDomain(asBdtScDetail())">
                                      <mat-option *ngFor="let codeList of filteredCodeLists(element)" [value]="codeList"
                                                  [disabled]="!isEditable() || element.bdtScPriRestri.inherited">
                                        <span class="{{ codeList.state === 'Deleted' ? 'text-line-through' : '' }}">{{ codeList.codeListName }}</span>
                                        <span class="f12 ml-auto"> ({{ codeList.versionId }}<span *ngIf="codeList.deprecated">, Deprecated</span><span *ngIf="codeList.state === 'Deleted'">, Deleted</span>)</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                  <mat-form-field *ngIf="element.type === 'AgencyIdList'">
                                    <mat-select [(ngModel)]="element.bdtScPriRestri.selectedAgencyIdList"
                                                [required]="true"
                                                (ngModelChange)="onChangeValueDomain(asBdtScDetail())">
                                      <mat-option *ngFor="let agencyIdList of filteredAgencyIdLists(element)" [value]="agencyIdList"
                                                  [disabled]="!isEditable() || element.bdtScPriRestri.inherited">
                                        <span>{{ agencyIdList.name }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="xbt">
                                <th mat-header-cell *matHeaderCellDef> XSD Expression</th>
                                <td mat-cell *matCellDef="let element">
                                  <mat-form-field *ngIf="element.type === 'Primitive'">
                                    <mat-select [(ngModel)]="element.xbtList" multiple>
                                      <mat-option *ngFor="let xbt of element.xbtList" [value]="xbt" [disabled]="true">
                                        <span>{{ xbt }}</span>
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                                </td>
                              </ng-container>
                              <tr mat-header-row *matHeaderRowDef="restrictionListDisplayedColumns"></tr>
                              <tr mat-row *cdkRowDef="let row; columns: restrictionListDisplayedColumns;"></tr>
                            </table>
                            <mat-toolbar>
                              <mat-toolbar-row>
                                <mat-form-field class="pt-2 w-50 pl-2">
                                  <mat-label>Default</mat-label>
                                  <mat-select [(ngModel)]="asBdtScDetail().defaultValueDomain">
                                    <mat-optgroup *ngFor="let valueDomain of asBdtScDetail().bdtScPriRestriListByGroup"
                                                  [label]="valueDomain.label">
                                      <mat-option *ngFor="let item of valueDomain.list" [value]="item" [disabled]="!isEditable()">
                                        {{ (item.type === 'Primitive') ? item.self.primitiveName + ' - ' + item.name : item.name }}
                                      </mat-option>
                                    </mat-optgroup>
                                  </mat-select>
                                </mat-form-field>
                              </mat-toolbar-row>
                            </mat-toolbar>
                          </mat-expansion-panel>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <input matInput placeholder="Definition Source" maxlength="200"
                                   [(ngModel)]="asBdtScDetail().definitionSource" [disabled]="!isEditable()">
                          </mat-form-field>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-12">
                          <mat-form-field>
                            <textarea matInput rows="6" cols="30"
                                      placeholder="Definition"
                                      [(ngModel)]="asBdtScDetail().definition"
                                      [disabled]="!isEditable()"></textarea>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </div>
            </as-split-area>
          </as-split>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
