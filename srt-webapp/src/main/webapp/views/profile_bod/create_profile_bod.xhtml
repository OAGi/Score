<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../../template.xhtml">

    <ui:define name="content">
        <div class="settings-next">
            <div class="subhead">
                <h2 class="subhead-heading">#{resourceBean.term('create_profile_bod.title')}</h2>
            </div>
        </div>

        <p:growl id="growl" showDetail="true" life="3000"/>

        <p:wizard flowListener="#{createProfileBODBean.onFlowProcess}" id="wizard" widgetVar="wizard"
                  showNavBar="false" onback="onBack();" onnext="onNext();">

            <!--
                Step 1: Select Top-Level Concept
            -->
            <p:tab id="step_1">
                <f:facet name="title">
                    <strong class="step">Step 1:</strong>
                    <h:outputText value="Select Top-Level Concept"/>
                </f:facet>
                <p:panel>
                    <f:facet name="header">
                        <div class="row">
                            <div class="col-md-2 dropdown-container">
                                <p:selectOneMenu id="release" value="#{createProfileBODBean.release}"
                                                 converter="#{releaseConverter}" style="width: 150px">
                                    <p:ajax listener="#{createProfileBODBean.onReleaseChange}"
                                            update=":form:growl, :form"/>
                                    <f:selectItems value="#{createProfileBODBean.releases}" var="release"
                                                   itemLabel="#{release.releaseNum}"
                                                   itemValue="#{release}"/>
                                </p:selectOneMenu>
                            </div>
                            <div class="col-md-10">
                                <div style="padding: 3px 0 3px 0;">
                                    <h:outputLabel value="#{resourceBean.term('create_profile_bod.step1.input.property_term')}"
                                                   style="width: #{resourceBean.termKeyPrefix() eq 'ccts' ? 120 : 340}px; font-weight: 400;"/>
                                    <p:inputText id="searchTextForPropertyTerm"
                                                 value="#{createProfileBODBean.searchTextForPropertyTerm}"
                                                 tabindex="1">
                                        <f:ajax/>
                                    </p:inputText>
                                </div>
                                <div style="padding: 3px 0 3px 0;">
                                    <h:outputLabel value="#{resourceBean.term('create_profile_bod.step1.input.module')}"
                                                   style="width: #{resourceBean.termKeyPrefix() eq 'ccts' ? 120 : 340}px; font-weight: 400;"/>
                                    <p:inputText id="searchTextForModule"
                                                 value="#{createProfileBODBean.searchTextForModule}"
                                                 tabindex="2">
                                        <f:ajax/>
                                    </p:inputText>

                                    <p:commandButton id="searchBtn" value="Search" ajax="true"
                                                     style="margin-left: 10px;"
                                                     actionListener="#{createProfileBODBean.search}"
                                                     update=":form:growl, :form:tbl1" icon="fa fa-white fa-search"/>
                                </div>

                                <p:defaultCommand target="searchBtn"/>
                            </div>
                        </div>
                    </f:facet>
                    <p:dataTable id="tbl1" var="topLevelConcept" value="#{createProfileBODBean.topLevelConcepts}"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                 paginator="true" paginatorPosition="bottom" rows="10"
                                 style="width: 100%; margin-bottom: 20px"
                                 selection="#{createProfileBODBean.selectedTopLevelConcept}"
                                 rowKey="#{topLevelConcept.asccpId}"
                                 selectionMode="single">
                        <p:ajax event="rowSelect" listener="#{createProfileBODBean.onTopLevelConceptSelect}"
                                update=":form:growl, :form:tbl1"/>
                        <p:ajax event="rowUnselect" listener="#{createProfileBODBean.onTopLevelConceptUnselect}"
                                update=":form:growl, :form:tbl1"/>

                        <p:column style="width: 50px; text-align: center;">
                            <p:selectBooleanCheckbox
                                    value="#{createProfileBODBean.getTopLevelConceptCheckBox(topLevelConcept.asccpId).checked}">
                                <p:ajax update=":form:growl, :form:tbl1"/>
                            </p:selectBooleanCheckbox>
                        </p:column>

                        <p:column style="width: 40%" headerText="Property Term"
                                  sortBy="#{topLevelConcept.propertyTerm}">
                            <h:outputText value="#{topLevelConcept.propertyTerm}"/>
                        </p:column>

                        <p:column headerText="Module" styleClass="ellipsis" sortBy="#{topLevelConcept.module}">
                            <h:outputText value="#{topLevelConcept.module}"/>
                        </p:column>

                        <p:column style="width: 200px; text-align: center;" headerText="Last Updated Time"
                                  sortBy="#{topLevelConcept.lastUpdateTimestamp}">
                            <h:outputText value="#{topLevelConcept.lastUpdateTimestamp}">
                                <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </p:tab>

            <!--
                Step 2: Select Business Context
            -->
            <p:tab id="step_2">
                <f:facet name="title">
                    <strong class="step">Step 2:</strong>
                    <h:outputText value="Select Business Context"/>
                </f:facet>
                <p:panel header="Selected Top-Level Concept">
                    <p:dataTable var="topLevelConcept" value="#{createProfileBODBean.selectedTopLevelConcept}"
                                 style="width: 100%; margin-bottom: 20px;">
                        <p:column style="width: 100px; text-align: center;" styleClass="ellipsis" headerText="Release">
                            <h:outputText value="#{createProfileBODBean.release.releaseNum}"/>
                        </p:column>

                        <p:column style="width: 40%" headerText="#{resourceBean.term('create_profile_bod.step2.table.column.asccp_property_term')}">
                            <h:outputText value="#{topLevelConcept.propertyTerm}"/>
                        </p:column>

                        <p:column headerText="#{resourceBean.term('create_profile_bod.step2.table.column.module')}" styleClass="ellipsis">
                            <h:outputText value="#{topLevelConcept.module}"/>
                        </p:column>

                        <p:column style="width: 200px; text-align: center;" headerText="Last Updated Time">
                            <h:outputText value="#{topLevelConcept.lastUpdateTimestamp}">
                                <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <p:panel>
                    <p:dataTable id="tbl2" var="businessContext"
                                 value="#{createProfileBODBean.businessContexts}"
                                 paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                 paginator="true" paginatorPosition="bottom" rows="10"
                                 style="width: 100%; margin-bottom:20px"
                                 selection="#{createProfileBODBean.selectedBusinessContext}"
                                 selectionMode="single"
                                 rowKey="#{businessContext.bizCtxId}">

                        <p:ajax event="rowSelect" listener="#{createProfileBODBean.onBusinessContextSelect}"
                                update=":form:growl, :form:tbl2"/>
                        <p:ajax event="rowUnselect" listener="#{createProfileBODBean.onBusinessContextUnselect}"
                                update=":form:growl, :form:tbl2"/>

                        <p:column style="width: 50px; text-align: center;">
                            <p:selectBooleanCheckbox
                                    value="#{createProfileBODBean.getBusinessContextCheckBox(businessContext.bizCtxId).checked}">
                                <p:ajax update=":form:growl, :form:tbl2"/>
                            </p:selectBooleanCheckbox>
                        </p:column>

                        <p:column headerText="Business Context Name" sortBy="#{businessContext.name}">
                            <h:outputText value="#{businessContext.name}"/>
                            <div>
                                <h:outputText value="GUID: #{businessContext.guid}"
                                              style="font-size: 12px !important; color: #767676 !important;"/>
                            </div>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </p:tab>
        </p:wizard>

        <p:panel id="btnGroup" style="margin-top: 40px;">
            <p:commandButton id="btnBack" widgetVar="btnBack" style="display: none;" update=":form:growl"
                             value="Back" icon="fa fa-white fa-arrow-left" oncomplete="PF('wizard').back();"/>
            <p:commandButton id="btnNext" widgetVar="btnNext" style="" update=":form:growl"
                             value="Next" icon="fa fa-white fa-arrow-right" oncomplete="PF('wizard').next();"/>
            <p:commandButton id="btnSubmit" widgetVar="btnSubmit" style="display: none;" update=":form:growl"
                             onclick="onSubmit();"
                             value="Submit" icon="fa fa-white fa-check" action="#{createProfileBODBean.submit()}"/>
        </p:panel>

        <script>
            var disableButtons = function () {
                var btnBack = $(document.getElementById(PF('btnBack').id));
                var btnNext = $(document.getElementById(PF('btnNext').id));
                var btnSubmit = $(document.getElementById(PF('btnSubmit').id));

                btnBack.prop("disabled", true).addClass('ui-state-disabled');
                btnNext.prop("disabled", true).addClass('ui-state-disabled');
                btnSubmit.prop("disabled", true).addClass('ui-state-disabled');
            };

            var onBack = function () {
                disableButtons();
            };

            var onNext = function () {
                disableButtons();

                var idx = PF('wizard').getStepIndex(PF('wizard').currentStep);
                var selected = $('tbody.ui-datatable-data tr[aria-selected="true"]').length > 0 ? true : false;
            };

            var onSubmit = function () {
                disableButtons();

                PF('loadingBlock').show();
            };
        </script>
    </ui:define>
</ui:composition>
