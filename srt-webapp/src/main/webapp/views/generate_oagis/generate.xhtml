<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../../template.xhtml">

    <ui:define name="content">
        <div class="settings-next">
            <div class="subhead">
                <h2 class="subhead-heading">#{resourceBean.term('bie_expression.title')}</h2>
            </div>
        </div>
        <p:panel id="panel">
            <h:outputText value="Selected Top-Level ABIEs" styleClass="option-header"/>
            <div class="row" style="margin-top: 15px;">
                <div class="col-md-12 col-sm-12">
                    <p:panel>
                        <f:facet name="header">
                            <p:autoComplete id="propertyTerm" value="#{profileBIEGenerationBean.selectedPropertyTerm}"
                                            completeMethod="#{profileBIEGenerationBean.completeInput}" maxResults="20"
                                            style="width: 440px; margin-right: 20px;">
                                <f:ajax/> <!-- dummy ajax component to update the value of autoComplete -->
                            </p:autoComplete>
                            <p:commandButton id="searchBtn" value="Search" ajax="true"
                                             actionListener="#{profileBIEGenerationBean.search}"
                                             update="tbl" icon="fa fa-white fa-search"/>
                        </f:facet>
                        <p:dataTable id="tbl" var="profileBIE" value="#{profileBIEGenerationBean.profileBIEs}"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     paginator="true" paginatorPosition="bottom" rows="10"
                                     style="width: 100%; margin-bottom:20px" rowKey="#{profileBIE.topLevelAbieId}"
                                     selection="#{profileBIEGenerationBean.selectedProfileBIEs}">
                            <p:column selectionMode="multiple" styleClass="table-checkbox"/>
                            <p:column headerText="Name" sortBy="#{profileBIE.propertyTerm}">
                                <h:outputText value="#{profileBIE.propertyTerm}"/>
                            </p:column>
                            <p:column style="width: 100px; text-align: center;" headerText="Release"
                                      sortBy="#{profileBIE.releaseNum}">
                                <h:outputText value="#{profileBIE.releaseNum}"/>
                            </p:column>
                            <p:column style="width: 200px; text-align: center;" headerText="Business Context"
                                      sortBy="#{profileBIE.bizCtxName}">
                                <h:outputText value="#{profileBIE.bizCtxName}"/>
                            </p:column>
                            <p:column style="width: 150px; text-align: center;" styleClass="ellipsis" headerText="Owner"
                                      sortBy="#{profileBIE.ownerName}">
                                <h:outputText value="#{profileBIE.ownerName}"/>
                            </p:column>
                            <p:column style="width: 200px; text-align: center;" headerText="Creation Timestamp"
                                      sortBy="#{profileBIE.creationTimestamp}">
                                <h:outputText value="#{profileBIE.creationTimestamp}">
                                    <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"/>
                                </h:outputText>
                            </p:column>
                            <p:column style="width: 100px; text-align: center;" headerText="State"
                                      sortBy="#{profileBIE.state}">
                                <h:panelGroup rendered="#{profileBIE.state == 'Editing'}">
                                    <span class="label label-primary">Editing</span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{profileBIE.state == 'Candidate'}">
                                    <span class="label label-warning">Candidate</span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{profileBIE.state == 'Published'}">
                                    <span class="label label-default">Published</span>
                                </h:panelGroup>
                            </p:column>
                            <p:ajax event="rowSelect" update=":form:btnPanel"/>
                            <p:ajax event="rowUnselect" update=":form:btnPanel"/>
                            <p:ajax event="rowSelectCheckbox" update=":form:btnPanel"/>
                            <p:ajax event="rowUnselectCheckbox" update=":form:btnPanel"/>
                            <p:ajax event="toggleSelect" update=":form:btnPanel"/>
                        </p:dataTable>
                    </p:panel>
                </div>
            </div>
        </p:panel>

        <p:panel id="optPanel1">
            <h:outputText value="Select annotation to generate" styleClass="option-header"/>
            <div class="row" style="margin-top: 15px;">
                <div class="col-md-6 col-sm-6">
                    <p:panel id="bieDocumentationOption" header="BIE Documentation Options">
                        <h:panelGrid columns="2" styleClass="option-panel">
                            <h:panelGroup styleClass="option-left">
                                <h:selectBooleanCheckbox id="definitionCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.bieDefinition}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="BIE Definition" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="remarkStatusCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.remarkAndStatus}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Remark &amp; Status" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>

                            <h:panelGroup styleClass="option-left"
                                          style="left: 20px;">
                                <h:selectBooleanCheckbox id="inheritCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.inheritIfEmpty}"
                                                         disabled="#{profileBIEGenerationBean.option.bieDocumentationOption.bieDefinition == false}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Inherit if empty"
                                              styleClass="#{profileBIEGenerationBean.option.bieDocumentationOption.bieDefinition == false ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="versionCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.bieVersion}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="BIE Version" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>

                            <h:panelGroup styleClass="option-left">
                                <h:selectBooleanCheckbox id="guidCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.bieGuid}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="BIE GUID" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="termCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.businessTerm}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Business Term" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>

                            <h:panelGroup styleClass="option-left">
                                <h:selectBooleanCheckbox id="ctxCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.businessContext}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Business Context" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="othersCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.bieDocumentationOption.others}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="bieDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Others (DEN, etc.)" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                        </h:panelGrid>
                    </p:panel>
                </div>
                <div class="col-md-6 col-sm-6">
                    <p:panel id="ccDocumentationOption" header="CC Documentations Options">
                        <h:panelGrid columns="2" styleClass="option-panel">
                            <h:panelGroup styleClass="option-left">
                                <h:selectBooleanCheckbox id="ccDefinitionCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.ccDocumentationOption.ccDefinition}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="ccDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="CC Definition" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="ccVersionCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.ccDocumentationOption.ccVersion}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="ccDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="CC Version" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>

                            <h:panelGroup styleClass="option-left">
                                <h:selectBooleanCheckbox id="ccguidCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.ccDocumentationOption.ccGuid}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="ccDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="CC GUID" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="option-right">
                                <h:selectBooleanCheckbox id="ccOthersCB" styleClass="boolean-checkbox"
                                                         value="#{profileBIEGenerationBean.option.ccDocumentationOption.others}"
                                                         disabled="#{profileBIEGenerationBean.option.schemaExpression ne 'XML'}">
                                    <f:ajax render="ccDocumentationOption"/>
                                </h:selectBooleanCheckbox>
                                <h:outputText value="Others (DEN, etc.)" styleClass="#{profileBIEGenerationBean.option.schemaExpression ne 'XML' ? 'outputtext-disabled' : ''}"/>
                            </h:panelGroup>
                        </h:panelGrid>
                    </p:panel>
                </div>
            </div>
        </p:panel>

        <p:panel id="optPanel2">
            <div class="row" style="margin-top: 15px;">
                <div class="col-md-4 col-sm-4">
                    <h:outputText value="Select Expressions" styleClass="option-header"/>
                    <h:panelGrid id="schemaExpressionOption"
                                 columns="1" styleClass="option-panel" style="margin-top: 15px;">
                        <h:selectOneRadio id="expressionRadio" styleClass="option-radio"
                                          value="#{profileBIEGenerationBean.option.schemaExpression}">
                            <f:selectItem itemValue="XML" itemLabel="XML Schema"/>
                            <f:selectItem itemValue="JSON" itemLabel="JSON Schema"/>
                            <f:ajax listener="#{profileBIEGenerationBean.onChangeSchemaExpressionOption()}" render=":form:optPanel1"/>
                        </h:selectOneRadio>
                    </h:panelGrid>
                </div>
                <div class="col-md-8 col-sm-8">
                    <h:outputText value="Schema Package Option" styleClass="option-header"/>
                    <h:panelGrid id="schemaPackageOption"
                                 columns="1" styleClass="option-panel" style="margin-top: 15px;">
                        <h:selectOneRadio id="packageRadio" styleClass="option-radio"
                                          value="#{profileBIEGenerationBean.option.schemaPackage}">
                            <f:selectItem itemValue="All" itemLabel="Put all schemas in the same package"/>
                            <f:selectItem itemValue="Each" itemLabel="Put each schemas in the different package"/>
                            <f:ajax render=":form:optPanel1"/>
                        </h:selectOneRadio>
                    </h:panelGrid>
                </div>
            </div>
        </p:panel>

        <h:panelGroup id="btnPanel" style="display: inline-block; margin-top: 20px;">
            <p:commandButton id="btnGenerate" ajax="false" value="Generate" icon="fa fa-white fa-external-link"
                             onclick="PrimeFaces.monitorDownload(function() { PF('loadingBlock').show(); }, function() { PF('loadingBlock').hide(); })"
                             actionListener="#{profileBIEGenerationBean.generate}"
                             disabled="#{profileBIEGenerationBean.selectedProfileBIEs.isEmpty() == true}">
                <p:fileDownload value="#{profileBIEGenerationBean.file}"/>
            </p:commandButton>
        </h:panelGroup>

        <script>
            var btnGenerate = $(document.getElementById('form:btnGenerate'));
            btnGenerate.prop("disabled", true).addClass('ui-state-disabled');
        </script>
    </ui:define>
</ui:composition>
